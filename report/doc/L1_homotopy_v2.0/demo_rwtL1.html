<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of demo_rwtL1</title>
  <meta name="keywords" content="demo_rwtL1">
  <meta name="description" content="demo_rwtL1">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html L1_homotopy_v2.0 -->
<h1>demo_rwtL1
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>demo_rwtL1</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> demo_rwtL1

 Solves the following reweighted BPDN problem
 min_x  \sum w_i |x_i| + 1/2*||y-Ax||_2^2

 Written by: Salman Asif, Georgia Tech
 Email: sasif@gatech.edu
 Created: August 2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>	l1homotopy.m</li><li><a href="../L1_homotopy_v2.0/utils/genAmat.html" class="code" title="function A = genAmat(M,N,in);">genAmat</a>	</li><li><a href="../L1_homotopy_v2.0/utils/genSignal.html" class="code" title="function [x varargout] = genSignal(N,in)">genSignal</a>	Inputs</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="readme.html" class="code" title="">readme</a>	----------L1 Homotopy Package-------------+</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% demo_rwtL1</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Solves the following reweighted BPDN problem</span>
0004 <span class="comment">% min_x  \sum w_i |x_i| + 1/2*||y-Ax||_2^2</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Written by: Salman Asif, Georgia Tech</span>
0007 <span class="comment">% Email: sasif@gatech.edu</span>
0008 <span class="comment">% Created: August 2012</span>
0009 
0010 clear
0011 close all force
0012  
0013 
0014 <span class="comment">%% Setup path</span>
0015 mname = mfilename;
0016 mpath = mfilename(<span class="string">'fullpath'</span>);
0017 mdir = mpath(1:end-length(mname));
0018 cd(mdir);
0019 
0020 addpath utils/
0021 addpath utils/qr/
0022 addpath utils/utils_Wavelet
0023 
0024 disp([<span class="string">'--------------------'</span>,datestr(now),<span class="string">'-------------------------'</span>])
0025 
0026 <span class="comment">% load RandomStates</span>
0027 <span class="comment">%</span>
0028 rseed = 2012;
0029 rand(<span class="string">'state'</span>,rseed);
0030 randn(<span class="string">'state'</span>,rseed);
0031 
0032 <span class="comment">% simulation parameters</span>
0033 mType = <span class="string">'randn'</span>; <span class="comment">% {'randn','orth','rdct'};</span>
0034 sType = <span class="string">'randn'</span>; <span class="comment">% {'randn','sign','highD', 'blocks','pcwPoly'}</span>
0035 SNR = 40;       <span class="comment">% additive Gaussian noise</span>
0036 
0037 <span class="comment">% reweighted setup</span>
0038 rwt = 5;        <span class="comment">% number of reweighting iterations</span>
0039 
0040 N = 256;   <span class="comment">% signal length</span>
0041 M = round(N/2);    <span class="comment">% no. of measurements</span>
0042 T = round(M/3);    <span class="comment">% sparsity level</span>
0043 
0044 <span class="comment">% rank-1 update mode</span>
0045 delx_mode = <span class="string">'mil'</span>; <span class="comment">% mil or qr</span>
0046 fprintf(<span class="string">'Iterative reweighting..\n'</span>);
0047 str0 = sprintf(<span class="string">'mType-%s, sType-%s, SNR = %d, (N,M,T) = %d, %d, %d.'</span>, mType, sType, SNR, N, M, T);
0048 disp(str0);
0049  
0050 maxsim = 10;
0051 SIM_stack = cell(maxsim,1);
0052 SIM_memory = cell(maxsim,1);
0053                                 
0054  
0055 <span class="keyword">for</span> sim = 1:maxsim
0056    
0057     <span class="comment">% Generate a random signal</span>
0058     in = []; in.type = sType; in.T = T; in.randgen = 1;
0059     x = <a href="../L1_homotopy_v2.0/utils/genSignal.html" class="code" title="function [x varargout] = genSignal(N,in)">genSignal</a>(N,in); 
0060     [val ind] = sort(abs(x),<span class="string">'descend'</span>);
0061     ind_pos = ind(val&gt;1e-1);
0062     gamma_orig = ind_pos(1:min(length(ind_pos),M-1));
0063     
0064 
0065     <span class="comment">% measurement matrix</span>
0066     in = []; in.type = mType;
0067     A = <a href="../L1_homotopy_v2.0/utils/genAmat.html" class="code" title="function A = genAmat(M,N,in);">genAmat</a>(M,N,in);
0068     
0069     <span class="comment">% measurements</span>
0070     sigma = sqrt(norm(A*x)^2/10^(SNR/10)/M);    
0071     e = randn(M,1)*sigma;
0072     y = A*x+e;
0073     
0074     <span class="comment">%     % orthogonalize rows of A</span>
0075     <span class="comment">%     [Q, R] = qr(A',0);</span>
0076     <span class="comment">%     A = Q'; y = R' \ y;</span>
0077     
0078     <span class="comment">% parameter selection</span>
0079     <span class="comment">% tau = sigma*sqrt(log(N));</span>
0080     tau = max(1e-4*max(abs(A'*y)),sigma*sqrt(log(N)));
0081     
0082     maxiter = 4*N;
0083     err_fun = @(z) (norm(x-z)/norm(x))^2;
0084     
0085     <span class="comment">%% BPDN using l1homotopy</span>
0086     in = [];   
0087     in.tau = tau;
0088     in.delx_mode = delx_mode;
0089     in.debias = 0;
0090     in.verbose = 0;
0091     in.plots = 0;
0092     in.record = 1;
0093     in.err_fun = err_fun;
0094     tic
0095     out = <a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>(A,y,in);
0096     xh = out.x_out;
0097     iter_bpdn = out.iter;
0098     time_bpdn = toc;
0099     gamma_bpdn = out.gamma;
0100     err_bpdn = out.error_table;
0101         
0102     <span class="comment">%% Iterative reweighting...</span>
0103     xh_old = xh; W_old = tau; 
0104     error_rwt = []; iter_rwt = []; time_rwt = []; 
0105     <span class="keyword">for</span> rwt_itr = 1:rwt
0106         
0107         <span class="comment">% Update weights</span>
0108         alpha = 1; epsilon = 1;
0109         beta = M*(norm(xh_old,2)/norm(xh_old,1))^2;
0110         W = tau/alpha./(beta*abs(xh_old)+epsilon);
0111         
0112         homotopy_mode = <span class="string">'dummy'</span>;
0113         <span class="keyword">switch</span> homotopy_mode
0114             <span class="keyword">case</span> <span class="string">'dummy'</span>                
0115                 <span class="comment">% create a dummy variable...</span>
0116                 <span class="comment">% use homotopy on the measurements...</span>
0117                 <span class="comment">% in principle, we can start with any xh_old with this formulation</span>
0118                 <span class="comment">% and any starting value of W_old (for instance W)...</span>
0119                 W_old = W;
0120                 <span class="comment">% yh = A*xh_old;</span>
0121                 <span class="comment">% u = -sign(xh_old).*W_old; % out.pk;</span>
0122                 <span class="comment">% Atdyu = A'*(yh-y)-u;</span>
0123                 yh = A*xh_old;
0124                 Atr = A'*(A*xh_old-y);
0125                 u =  -W.*sign(xh_old)-Atr;
0126                 pk_old = Atr+u;
0127             <span class="keyword">otherwise</span>
0128                 <span class="comment">% use homotopy on weights</span>
0129                 u = out.pk;
0130                 Atdyu = 0;
0131         <span class="keyword">end</span>
0132         
0133         in = out;
0134         in.xh_old = xh_old;
0135         in.pk_old = pk_old;
0136         in.u = u;
0137         in.W_old = W_old;
0138         in.W = W;
0139         <span class="comment">% in.Atdyu = Atdyu;</span>
0140         in.delx_mode = delx_mode;
0141         in.debias = 0;
0142         in.verbose = 0;
0143         in.plots = 0;
0144         in.record = 1;
0145         in.err_fun = @(z) (norm(x-z)/norm(x))^2;
0146         tic
0147         out = <a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>(A,y,in);
0148         xh_old = out.x_out;
0149         W_old = W;
0150         gamma_rwt = out.gamma;
0151         error_rwt = [error_rwt err_fun(xh_old)];
0152         iter_rwt = [iter_rwt out.iter];
0153         time_rwt = [time_rwt toc];
0154     <span class="keyword">end</span>
0155         
0156 <span class="comment">%     %% Check the solution using BPDN directly with l1homotopy</span>
0157 <span class="comment">%     in = []; x_old = x;</span>
0158 <span class="comment">%     in.W = W;</span>
0159 <span class="comment">%     in.delx_mode = delx_mode;</span>
0160 <span class="comment">%     in.debias = 0;</span>
0161 <span class="comment">%     in.verbose = 0;</span>
0162 <span class="comment">%     in.plots = 0;</span>
0163 <span class="comment">%     in.record = 1;</span>
0164 <span class="comment">%     in.err_fun = err_fun;</span>
0165 <span class="comment">%     tic</span>
0166 <span class="comment">%     out = l1homotopy(A,y,in);</span>
0167 <span class="comment">%     xh = out.x_out;</span>
0168 <span class="comment">%     iter_bpdn = out.iter;</span>
0169 <span class="comment">%     time_bpdn = toc;</span>
0170 <span class="comment">%     gamma_bpdn = out.gamma;</span>
0171 <span class="comment">%     err_bpdn = out.error_table;</span>
0172     
0173     <span class="comment">%%</span>
0174     SIM_stack{sim} = [sim, tau, <span class="keyword">...</span>
0175         norm(x-xh)^2/norm(x)^2, sum(iter_bpdn,2), sum(time_bpdn,2), <span class="keyword">...</span>
0176         norm(x-xh_old)^2/norm(x)^2, sum(iter_rwt,2), sum(time_rwt,2)];  
0177     
0178     fprintf(<span class="string">'sim %d. tau = %3.4g, (err,iter,time): l1homotopy from scratch-%3.4g,%3.4g,%3.4g; rwt l1homotopy-%3.4g,%3.4g,%3.4g. \n'</span>, <span class="keyword">...</span>
0179         SIM_stack{sim});
0180 
0181     <span class="comment">%% plot recovered signals</span>
0182     figure(1); plot([x xh xh_old]);    
0183     title(<span class="string">'Comparison betweeen the new and old homotopy code'</span>)
0184 <span class="keyword">end</span>
0185 mS =  mean(cell2mat(SIM_stack),1);
0186 fprintf(<span class="string">'Average results: maxsim %d. tau = %3.4g, (err,iter,time): l1homotopy from scratch-%3.4g,%3.4g,%3.4g; rwt l1homotopy-%3.4g,%3.4g,%3.4g. \n'</span>, maxsim, mS(2:end));</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>