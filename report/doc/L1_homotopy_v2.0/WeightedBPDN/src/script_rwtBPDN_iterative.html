<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of script_rwtBPDN_iterative</title>
  <meta name="keywords" content="script_rwtBPDN_iterative">
  <meta name="description" content="BPDN rwt update (initialize with standard homotopy)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html L1_homotopy_v2.0 --><!-- ../menu.html WeightedBPDN --><!-- menu.html src -->
<h1>script_rwtBPDN_iterative
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>BPDN rwt update (initialize with standard homotopy)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function out = script_rwtBPDN_iterative(in); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> BPDN rwt update (initialize with standard homotopy)

 Solve the following basis pursuit denoising (BPDN) problem
 min_x  \Sum \w_i |x_i| + 1/2*||y-Ax||_2^2

 Initialize with unweighted BPDN
 and dynamically update the weights w_i

 Written by: Salman Asif, Georgia Tech
 Email: sasif@ece.gatech.edu
 Created: March 16, 2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>	BPDN_homotopy_function.m</li><li><a href="weight_param.html" class="code" title="function [alpha beta epsilon] = weight_param(rwt_mode,itr,varargin)">weight_param</a>	Compute alpha,beta, and epsilon to update weights as</li><li><a href="wtBPDN_Update_function_v1.html" class="code" title="function out = wtBPDN_Update_function_v1(A, y, in);">wtBPDN_Update_function_v1</a>	Iterative reweighting updates for BPDN</li><li><a href="wtBPDN_Update_function_v2.html" class="code" title="function out = wtBPDN_Update_function_v2(A, y, in);">wtBPDN_Update_function_v2</a>	BPDN_homotopy_ReWeighted.m</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../L1_homotopy_v2.0/WeightedBPDN/demo_wtBPDN.html" class="code" title="">demo_wtBPDN</a>	demo_wtBPDN</li><li><a href="script_simulation_wtBPDN.html" class="code" title="">script_simulation_wtBPDN</a>	partial script for running different solvers</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% BPDN rwt update (initialize with standard homotopy)</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Solve the following basis pursuit denoising (BPDN) problem</span>
0004 <span class="comment">% min_x  \Sum \w_i |x_i| + 1/2*||y-Ax||_2^2</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% Initialize with unweighted BPDN</span>
0007 <span class="comment">% and dynamically update the weights w_i</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Written by: Salman Asif, Georgia Tech</span>
0010 <span class="comment">% Email: sasif@ece.gatech.edu</span>
0011 <span class="comment">% Created: March 16, 2011</span>
0012 
0013 <a name="_sub0" href="#_subfunctions" class="code">function out = script_rwtBPDN_iterative(in);</a>
0014 A = in.A; y = in.y; x = in.x;
0015 gamma_orig = find(x);
0016 [M N] = size(A);
0017 tau = in.tau; max_rwt = in.max_rwt;
0018 x_init = in.x_init;
0019 
0020 <span class="comment">%% parameter selection</span>
0021 <span class="comment">% max_rwt = 3;</span>
0022 <span class="comment">% lambda = 1e-2;</span>
0023 <span class="comment">% tau = min(lambda*max(abs(A'*y)),sigma*sqrt(log(N)));</span>
0024 
0025 rwt_mode = in.rwt_mode; 
0026 
0027 delx_mode = in.delx_mode;
0028 homotopy_update = <span class="string">'v1'</span>;
0029 
0030 maxiter = 2*N;
0031 iter_ALL = [];
0032 err_ALL = [];
0033 time_ALL = [];
0034 supp_diff = [];
0035 
0036 <span class="keyword">if</span> norm(x_init) == 0
0037     <span class="comment">%% Standard BPDN</span>
0038     in = [];
0039     in.tau = tau;
0040     in.maxiter = maxiter;
0041     in.x_orig = x;
0042     in.record = 1;
0043     in.delx_mode = delx_mode;
0044     tic;
0045     out = <a href="../../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(A, y, in); <span class="comment">%BPDN</span>
0046     <span class="comment">% time_ALL = [time_ALL out.time];</span>
0047     time_ALL = [time_ALL toc];
0048     
0049     x_init = out.x_out;
0050     gamma_old = out.gamma;
0051     iter_old = out.iter;
0052     iter_ALL = [iter_ALL iter_old];
0053     err_ALL = [err_ALL norm(x-x_init)/norm(x)];
0054     
0055     supp_diff = [supp_diff length(setxor(gamma_old,gamma_orig))];
0056 <span class="keyword">end</span>
0057 W_new = ones(N,1)*tau; <span class="comment">% homotopy solved with same fixed weights.</span>
0058 
0059 <span class="comment">%% Iterative reweighting</span>
0060 xh_mod = x_init;
0061 gamma_xh = gamma_old;
0062 <span class="keyword">for</span> rwt_itr = 1:max_rwt
0063     gamma_old = gamma_xh;
0064     x_old = xh_mod;
0065     W_old = W_new;
0066     
0067     [alpha beta epsilon] = <a href="weight_param.html" class="code" title="function [alpha beta epsilon] = weight_param(rwt_mode,itr,varargin)">weight_param</a>(rwt_mode,rwt_itr,x_old,M);
0068     W_new = tau/alpha./(beta*abs(x_old)+epsilon);
0069     
0070     <span class="comment">% W_new = tau/epsilon*ones(N,1);</span>
0071     <span class="comment">% W_new(gamma_old) = min([tau*ones(length(gamma_old),1) tau./(beta*abs(x_old(gamma_old)))],[],2);</span>
0072     
0073     <span class="keyword">switch</span> homotopy_update
0074         <span class="keyword">case</span> <span class="string">'v1'</span>
0075             pk_old = A'*(A*x_old-y);
0076             pk_old(gamma_old) = sign(pk_old(gamma_old)).*W_old(gamma_old);
0077             in = [];
0078             in.x_old = x_old;
0079             in.gamma = gamma_old;
0080             in.pk_old = pk_old;
0081             in.W_old = W_old;
0082             in.W_new = W_new;
0083             dW = W_new-W_old;
0084             in.maxiter = maxiter;
0085             
0086             <span class="comment">% delx = -AtAgx\(-dW(gamma_old).*sign(pk_old(gamma_old)));</span>
0087             <span class="comment">% in.delx = delx;</span>
0088             in.delx_mode = delx_mode;
0089             <span class="keyword">switch</span> in.delx_mode
0090                 <span class="keyword">case</span> <span class="string">'mil'</span>;
0091                     <span class="comment">% in.delx_mode = 'mil';</span>
0092                     <span class="comment">% The following gram matrix and its inverse can be used from the</span>
0093                     <span class="comment">% previous homotopy. Too lazy to include that right now...</span>
0094                     <span class="comment">% wt BPDN homotopy update</span>
0095                     AtAgx = A(:,gamma_old)'*A(:,gamma_old);
0096                     iAtAgx = inv(AtAgx);
0097                     in.AtA = AtAgx;
0098                     in.iAtA = iAtAgx;
0099                 <span class="keyword">case</span> {<span class="string">'qr'</span>,<span class="string">'chol'</span>};
0100                     <span class="comment">% in.delx_mode = 'qr';</span>
0101                     [Q R] = qr(A(:,gamma_old),0);
0102                     in.Q = Q; in.R = R;
0103                 <span class="keyword">case</span> <span class="string">'qrM'</span>
0104                     <span class="comment">% in.delx_mode = 'qrM';</span>
0105                     [Q0 R0] = qr(A(:,gamma_old));
0106                     in.Q0 = Q0; in.R0 = R0;
0107             <span class="keyword">end</span>
0108             tic
0109             out = <a href="wtBPDN_Update_function_v1.html" class="code" title="function out = wtBPDN_Update_function_v1(A, y, in);">wtBPDN_Update_function_v1</a>(A, y, in);
0110             <span class="comment">% time_update = out.time;</span>
0111             time_update = toc;
0112             xh_mod = out.x_out;
0113             gamma_xh = out.gamma;
0114             iter_update = out.iter;
0115             
0116         <span class="keyword">case</span> <span class="string">'v2'</span>
0117             
0118             <span class="comment">% Homotopy update v2 (weighting embedded in the matrix A)</span>
0119             AW_old = A*diag(tau./W_old);
0120             u0_hat = x_old.*(W_old/tau);
0121             ds = AW_old'*(AW_old*u0_hat-y);
0122             AW = A*diag(tau./W_new);
0123             yhat = AW*u0_hat;
0124             pk_old = ds; pk_old(gamma_old) = sign(pk_old(gamma_old)).*tau;
0125             in = [];
0126             in.x_old = u0_hat;
0127             in.gamma = gamma_old;
0128             in.pk_old = pk_old;
0129             in.tau = tau;
0130             in.maxiter = maxiter;
0131             in.yhat = yhat;
0132             
0133             <span class="comment">% ds = pk_old; d = AW'*(yhat-y);</span>
0134             <span class="comment">% delx = AtAgx\(ds(gamma_old)-d(gamma_old));</span>
0135             <span class="comment">% in.delx = delx;</span>
0136             in.delx_mode = delx_mode;
0137             <span class="keyword">switch</span> in.delx_mode
0138                 <span class="keyword">case</span> <span class="string">'mil'</span>;
0139                     <span class="comment">% in.delx_mode = 'mil';</span>
0140                     AtAgx = AW(:,gamma_old)'*AW(:,gamma_old);
0141                     iAtAgx = inv(AtAgx);                    
0142                     in.AtA = AtAgx;
0143                     in.iAtA = iAtAgx;
0144                 <span class="keyword">case</span> {<span class="string">'qr'</span>,<span class="string">'chol'</span>};
0145                     <span class="comment">% in.delx_mode = 'qr';</span>
0146                     [Q R] = qr(AW(:,gamma_old),0);
0147                     in.Q = Q; in.R = R;
0148                 <span class="keyword">case</span> <span class="string">'qrM'</span>
0149                     <span class="comment">% in.delx_mode = 'qrM';</span>
0150                     [Q0 R0] = qr(AW(:,gamma_old));
0151                     in.Q0 = Q0; in.R0 = R0;
0152             <span class="keyword">end</span>
0153             tic
0154             out = <a href="wtBPDN_Update_function_v2.html" class="code" title="function out = wtBPDN_Update_function_v2(A, y, in);">wtBPDN_Update_function_v2</a>(AW, y, in);
0155             time_update = out.time;
0156             time_update = toc;
0157             xh_mod = out.x_out.*(tau./W_new);
0158             gamma_xh = out.gamma;
0159             iter_update = out.iter;
0160     <span class="keyword">end</span>
0161     iter_ALL = [iter_ALL iter_update];
0162     err_ALL = [err_ALL norm(x-xh_mod)/norm(x)];
0163     time_ALL = [time_ALL time_update];
0164     supp_diff = [supp_diff length(setxor(gamma_xh,gamma_orig))];    
0165     
0166     <span class="comment">%     % compare with solution from scratch</span>
0167     <span class="comment">%     in = [];</span>
0168     <span class="comment">%     in.tau = tau;</span>
0169     <span class="comment">%     in.maxiter = maxiter;</span>
0170     <span class="comment">%     in.x_orig = x;</span>
0171     <span class="comment">%     in.record = 1;</span>
0172     <span class="comment">%     AW = A*diag(tau./W_new);</span>
0173     <span class="comment">%     out_new = BPDN_homotopy_function(AW, y, in); %BPDN</span>
0174     <span class="comment">%     xh_mod = out_new.x_out.*(tau./W_new);</span>
0175     <span class="comment">%     gamma_new = out_new.gamma;</span>
0176     <span class="comment">%     new_iter = out_new.iter;</span>
0177     <span class="comment">%     new_time = out_new.time;</span>
0178     
0179     <span class="comment">%     figure(1);</span>
0180     <span class="comment">%     subplot(221); plot([x xh xh_v2 xh_mod]);</span>
0181     <span class="comment">%     subplot(222); plot([xh-xh_v2 xh-xh_mod]);</span>
0182     <span class="comment">%     subplot(223); plot(xh,x,'.');</span>
0183     <span class="comment">%     subplot(224); plot([W_new W_old]);</span>
0184     <span class="comment">%     err_rec = norm(xh-x)/norm(x);</span>
0185     <span class="comment">%     err_old = norm(x_init-x)/norm(x);</span>
0186     <span class="comment">% disp(sprintf(['RWT iter. = %d, wtBPDN-LASSO homotopy iter. = %d, Update = %d, Update-v2=%d, Rec. error = %3.4g, improve = %3.4g'], rwt_itr, new_iter, iter_update, update_iter_v2, err_rec , (err_old-err_rec)/err_old*100));</span>
0187 <span class="keyword">end</span>
0188 
0189 out.x_out = xh_mod;
0190 out.x_init = x_init;
0191 out.iter = iter_ALL;
0192 out.gamma = gamma_xh;
0193 out.W_new = W_new;
0194 out.err = err_ALL;
0195 out.time = time_ALL;
0196 out.supp_diff = supp_diff;</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>