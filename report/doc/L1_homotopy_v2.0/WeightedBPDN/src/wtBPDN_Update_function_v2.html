<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of wtBPDN_Update_function_v2</title>
  <meta name="keywords" content="wtBPDN_Update_function_v2">
  <meta name="description" content="BPDN_homotopy_ReWeighted.m">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../../menu.html L1_homotopy_v2.0 --><!-- ../menu.html WeightedBPDN --><!-- menu.html src -->
<h1>wtBPDN_Update_function_v2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>BPDN_homotopy_ReWeighted.m</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function out = wtBPDN_Update_function_v2(A, y, in); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> BPDN_homotopy_ReWeighted.m

 Solves the following basis pursuit denoising (BPDN) problem
 min_x  \|x\|_1 + 1/2*||y-AWx||_2^2

 and dynamically update the weights w_i

 Inputs:
 A - m x n measurement matrix
 y - measurement vector
 in - input structure
   tau - value of regularization parameter
   x_old - old estimate
   gamma - old signal support
   AtA - A(:,gamma_xh)'*A(:,gamma_xh);
   iAtA  - inv(AtA)
   or QR/Cholesky factors
   pk_old - old constrtaints set
   yhat - dummy vector for old measuremnents
   maxiter - maximum number of homotopy iterations

 Outputs:
 out - output structure
   x_out - output for BPDN
   gamma - support of the solution
   iter - number of homotopy iterations taken by the solver
   time - time taken by the solver

 Written by: Salman Asif, Georgia Tech
 Email: sasif@ece.gatech.edu
 Created: March 16, 2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../L1_homotopy_v2.0/utils/update_delx.html" class="code" title="">update_delx</a>	script to ubpdate delx</li><li><a href="../../../L1_homotopy_v2.0/utils/update_supp.html" class="code" title="">update_supp</a>	script to update support</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="script_rwtBPDN_adaptive.html" class="code" title="function out = script_rwtBPDN_adaptive(in)">script_rwtBPDN_adaptive</a>	BPDN rwt update (initialize with adaptive_wtBPDN)</li><li><a href="script_rwtBPDN_iterative.html" class="code" title="function out = script_rwtBPDN_iterative(in);">script_rwtBPDN_iterative</a>	BPDN rwt update (initialize with standard homotopy)</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% BPDN_homotopy_ReWeighted.m</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Solves the following basis pursuit denoising (BPDN) problem</span>
0004 <span class="comment">% min_x  \|x\|_1 + 1/2*||y-AWx||_2^2</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% and dynamically update the weights w_i</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% Inputs:</span>
0009 <span class="comment">% A - m x n measurement matrix</span>
0010 <span class="comment">% y - measurement vector</span>
0011 <span class="comment">% in - input structure</span>
0012 <span class="comment">%   tau - value of regularization parameter</span>
0013 <span class="comment">%   x_old - old estimate</span>
0014 <span class="comment">%   gamma - old signal support</span>
0015 <span class="comment">%   AtA - A(:,gamma_xh)'*A(:,gamma_xh);</span>
0016 <span class="comment">%   iAtA  - inv(AtA)</span>
0017 <span class="comment">%   or QR/Cholesky factors</span>
0018 <span class="comment">%   pk_old - old constrtaints set</span>
0019 <span class="comment">%   yhat - dummy vector for old measuremnents</span>
0020 <span class="comment">%   maxiter - maximum number of homotopy iterations</span>
0021 <span class="comment">%</span>
0022 <span class="comment">% Outputs:</span>
0023 <span class="comment">% out - output structure</span>
0024 <span class="comment">%   x_out - output for BPDN</span>
0025 <span class="comment">%   gamma - support of the solution</span>
0026 <span class="comment">%   iter - number of homotopy iterations taken by the solver</span>
0027 <span class="comment">%   time - time taken by the solver</span>
0028 <span class="comment">%</span>
0029 <span class="comment">% Written by: Salman Asif, Georgia Tech</span>
0030 <span class="comment">% Email: sasif@ece.gatech.edu</span>
0031 <span class="comment">% Created: March 16, 2011</span>
0032 
0033 <a name="_sub0" href="#_subfunctions" class="code">function out = wtBPDN_Update_function_v2(A, y, in);</a>
0034 
0035 <span class="comment">% x_old, gamma_xh, AtAgx, iAtAgx, pk_old, W_old, W_new, maxiter</span>
0036 x_old = in.x_old;
0037 gamma_xh = in.gamma;
0038 pk_old = in.pk_old;
0039 yhat = in.yhat; <span class="comment">% dummy y (for warm-start)</span>
0040 <span class="comment">% ds = in.ds; % dummy d (for warm-start)</span>
0041 tau = in.tau;
0042 maxiter = in.maxiter;
0043 
0044 t0 = cputime;
0045 N = size(A,2);
0046 M = size(A,1);
0047 
0048 <span class="comment">% pk_old = A'*(A*x_k-y);</span>
0049 <span class="comment">% pk_old(gamma_xh) = sign(pk_old(gamma_xh)).*W_old(gamma_xh);</span>
0050 xk_1 = x_old;
0051 ds = pk_old;
0052 d = A'*(yhat-y);
0053 
0054 epsilon = 0;
0055 
0056 done = 0;
0057 iter = 0;
0058 itr_history = [];
0059 idelta = gamma_xh(1); flag = 1;
0060 
0061 <span class="comment">% initialize delx</span>
0062 in_delx = [];
0063 delx_mode = in.delx_mode;
0064 rhs = ds-d;
0065 update_mode = <span class="string">'init1'</span>;
0066 <a href="../../../L1_homotopy_v2.0/utils/update_delx.html" class="code" title="">update_delx</a>;
0067 
0068 <span class="keyword">while</span> ~done
0069     iter = iter+1;
0070     x_k = xk_1;
0071     z_x = -sign(pk_old);
0072     
0073     <span class="comment">% AtAgx_inv = inv(A(:,gamma_xh)'*A(:,gamma_xh));</span>
0074     <span class="comment">% AtAgx = (A(:,gamma_xh)'*A(:,gamma_xh));</span>
0075     <span class="comment">% norm(iAtAgx-AtAgx_inv)</span>
0076     <span class="comment">% delx = AtAgx\(ds(gamma_xh)-d(gamma_xh));</span>
0077     <span class="comment">% delx computation moved below...</span>
0078     
0079     delx_vec = zeros(N,1);
0080     delx_vec(gamma_xh) = delx;
0081     
0082     <span class="keyword">if</span> sign(delx_vec(idelta)) == sign(pk_old(idelta)) &amp;&amp; iter &gt; 1
0083         delta = 0; flag = 0;
0084     <span class="keyword">else</span>
0085         pk = pk_old;
0086         dk = A'*(A(:,gamma_xh)*delx)+d-ds;
0087         
0088         temp_gamma = zeros(N,1);
0089         temp_gamma(gamma_xh) = gamma_xh;
0090         gamma_xc = find([1:N]' ~= temp_gamma);
0091         
0092         <span class="comment">%% Calculate homotopy step size</span>
0093         delta1_constr = (tau-pk)./(dk);
0094         delta1_constr = delta1_constr(gamma_xc);
0095         delta2_constr = (-tau-pk)./(dk);
0096         delta2_constr = delta2_constr(gamma_xc);
0097         delta3_constr = (-x_k(gamma_xh)./delx);
0098         idelta_1 = (delta1_constr&gt;0);
0099         idelta_2 = (delta2_constr&gt;0);
0100         idelta_3 = (delta3_constr&gt;0);
0101         delta1 = min(delta1_constr(idelta_1));
0102         delta2 = min(delta2_constr(idelta_2));
0103         delta3 = min(delta3_constr(idelta_3));
0104         <span class="keyword">if</span> isempty(delta1); delta1 = inf; <span class="keyword">end</span>
0105         <span class="keyword">if</span> isempty(delta2); delta2 = inf; <span class="keyword">end</span>
0106         <span class="keyword">if</span> isempty(delta3); delta3 = inf; <span class="keyword">end</span>
0107         <span class="keyword">if</span> delta1&gt;delta2
0108             delta = delta2;
0109             idelta = gamma_xc(delta2_constr==delta2);
0110             flag = 1;
0111         <span class="keyword">else</span>
0112             delta = delta1;
0113             idelta = gamma_xc(delta1_constr==delta1);
0114             flag = 1;
0115         <span class="keyword">end</span>
0116         <span class="keyword">if</span> delta3 &lt;= delta
0117             delta = delta3;
0118             idelta = gamma_xh(delta3_constr == delta3);
0119             flag = 0;
0120         <span class="keyword">end</span>
0121     <span class="keyword">end</span>
0122     <span class="comment">%% Update support</span>
0123     e0 = epsilon;
0124     epsilon = e0 + delta;
0125     
0126     <span class="keyword">if</span> epsilon &gt; 1
0127         delta_end = 1-e0;
0128         xk_1 = x_k + delta_end*delx_vec;
0129         <span class="keyword">break</span>;
0130     <span class="keyword">end</span>
0131     
0132     xk_1 = x_k + delta*delx_vec;
0133     gamma_x_old = gamma_xh;
0134     
0135     <span class="comment">% disp(sprintf(['iter = %d, delta = %3.4g, idelta = %d, flag = %d'], iter, delta, idelta, flag));</span>
0136     itr_history = [itr_history; idelta delta flag];
0137     
0138     <span class="comment">% update support</span>
0139     <a href="../../../L1_homotopy_v2.0/utils/update_supp.html" class="code" title="">update_supp</a>
0140     
0141     pk_old = pk+delta*dk;
0142     pk_old([gamma_xh; idelta]) = sign(pk_old([gamma_xh; idelta])).*tau;
0143     
0144     <span class="comment">% update delx</span>
0145     rhs = ds-d;
0146     update_mode = <span class="string">'update'</span>;
0147     <a href="../../../L1_homotopy_v2.0/utils/update_delx.html" class="code" title="">update_delx</a>;
0148     
0149     <span class="comment">%     figure(1); plot([Wk(gamma_xh)-abs(A(:,gamma_xh)'*(A*xk_1-y))])</span>
0150     <span class="comment">%     figure(2); plot([Wk(gamma_xh) abs(A(:,gamma_xh)'*(A*xk_1-y))])</span>
0151     <span class="comment">%     figure(3); plot(delx_vec);</span>
0152     
0153     <span class="comment">% disp(sprintf(['idelta = %d, delta = %3.4g, flag = %d'],idelta, delta, flag));</span>
0154     
0155     constr_violation = nnz((abs(pk_old(gamma_xc))-tau)&gt;1e-10);
0156     sign_violation = nnz((sign(pk_old(gamma_xh))+sign(xk_1(gamma_xh)))&gt;1);
0157     <span class="keyword">if</span> constr_violation
0158         chk = gamma_xc((abs(pk_old(gamma_xc))-tau)&gt;1e-10);
0159         stp = 1;
0160         fprintf(<span class="string">'problem... with constraint violation -- %s'</span>, mfilename);
0161         <span class="comment">% some times it comes here due to bad conditioning of AtAgx.</span>
0162         fprintf(<span class="string">'Refactorize the matrix... recompute delx \n'</span>);
0163         update_mode = <span class="string">'init0'</span>;
0164         <a href="../../../L1_homotopy_v2.0/utils/update_delx.html" class="code" title="">update_delx</a>;
0165     <span class="keyword">end</span>
0166     <span class="keyword">if</span> sign_violation&gt;=1
0167         chk = gamma_xh(sign(pk_old(gamma_xh))+sign(xk_1(gamma_xh))&gt;1);
0168         stp = 1;
0169         fprintf(<span class="string">'problem... sign mismatch -- %s'</span>,mfilename);
0170         fprintf(<span class="string">'Refactorize the matrix... recompute delx \n'</span>);
0171         update_mode = <span class="string">'init0'</span>;
0172         <a href="../../../L1_homotopy_v2.0/utils/update_delx.html" class="code" title="">update_delx</a>;
0173     <span class="keyword">end</span>
0174     <span class="comment">% figure(1);</span>
0175     <span class="comment">% plot([abs(A(:,gamma_xh)'*(A*x_k-(1-e0)*yhat-e0*y)+(1-e0)*ds(gamma_xh))-tau abs(A(:,gamma_xh)'*(A*xk_1-(1-epsilon)*yhat-epsilon*y)+(1-epsilon)*ds(gamma_xh))-tau])</span>
0176     <span class="comment">% plot(abs(A(:,gamma_xh)'*(A*xk_1-(1-epsilon)*yhat-epsilon*y)+(1-epsilon)*ds(gamma_xh))-tau)</span>
0177 <span class="keyword">end</span>
0178 
0179 total_iter = iter;
0180 total_time = cputime-t0;
0181 
0182 out = [];
0183 out.x_out = xk_1;
0184 out.gamma = gamma_xh;
0185 out.iter = total_iter;
0186 out.time = total_time;</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>