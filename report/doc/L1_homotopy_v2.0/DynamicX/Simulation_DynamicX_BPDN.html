<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Simulation_DynamicX_BPDN</title>
  <meta name="keywords" content="Simulation_DynamicX_BPDN">
  <meta name="description" content="Simulation for BPDN homotopy update of DynamicX.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html DynamicX -->
<h1>Simulation_DynamicX_BPDN
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Simulation for BPDN homotopy update of DynamicX.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Simulation for BPDN homotopy update of DynamicX.
 Compare warm start of GPSR and FPC with the homotopy update of BPDN.
 Need GPSR and FPC packages in your matlab path to run this simulation.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="DynamicX_BPDN_function.html" class="code" title="function [xp_h, gamma_xh, iter,cpu] = DynamicX_BPDN_function(A, AtAgx, iAtAgx, y, yt, xp, gamma_x, pk, tau, maxiter)">DynamicX_BPDN_function</a>	DynamicX_BPDN_function.m</li><li><a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>	BPDN_homotopy_function.m</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Simulation for BPDN homotopy update of DynamicX.</span>
0002 <span class="comment">% Compare warm start of GPSR and FPC with the homotopy update of BPDN.</span>
0003 <span class="comment">% Need GPSR and FPC packages in your matlab path to run this simulation.</span>
0004 
0005 clear 
0006 clear classes; close all; 
0007 
0008 <span class="comment">% % load fixed random states</span>
0009 <span class="comment">% load RandomStates</span>
0010 <span class="comment">% rand('state', s_rand);</span>
0011 <span class="comment">% randn('state', s_randn);</span>
0012 
0013 sim_runs = 10; <span class="comment">% Run for large number of simulations to compare the performance.</span>
0014 tau_table = [.5, .1, .05, .01];
0015 outer_iterations = length(tau_table);
0016 
0017 stack_time_solve = zeros(sim_runs*outer_iterations,4);
0018 stack_time_update = zeros(sim_runs*outer_iterations,3);
0019 stack_iter = zeros(sim_runs*outer_iterations,9);
0020 
0021 <span class="keyword">for</span> out_iter = 1:outer_iterations
0022     <span class="keyword">for</span> sim_iter = 1:sim_runs
0023         <span class="comment">% n is the original signal length</span>
0024         n = 1024;
0025 
0026         <span class="comment">% k is number of observations to make</span>
0027         k = 512;
0028 
0029         <span class="comment">% number of spikes to put down</span>
0030         <span class="comment">% n_spikes = floor(.01*n);</span>
0031         ratio_sp = 5;
0032         n_spikes = round(k/ratio_sp);
0033         T = n_spikes;
0034 
0035         <span class="comment">% random +/- 1 signal</span>
0036         x = zeros(n,1);
0037         q = randperm(n);
0038         x(q(1:n_spikes)) = sign(randn(n_spikes,1));
0039         <span class="comment">% x(q(1:n_spikes)) = randn(n_spikes,1);</span>
0040 
0041         <span class="comment">% measurement matrix</span>
0042         A = randn(k,n)/sqrt(k);
0043         <span class="comment">% orthonormalize rows</span>
0044         <span class="comment">% A = orth(A')';</span>
0045 
0046         <span class="comment">% noisy observations</span>
0047         sigma = 0.01; <span class="comment">% how much noise to add should depend on power of Ax</span>
0048         e = randn(k,1)*sigma;
0049         y = A*x + e;
0050 
0051         <span class="comment">% regularization parameter</span>
0052         tau = tau_table(out_iter)*max(abs(A'*y)); <span class="comment">% l1_ls</span>
0053         <span class="comment">% if sigma&gt;0</span>
0054         <span class="comment">%     tau = sigma * sqrt(log(n)*2); % BPDN</span>
0055         <span class="comment">%     %tau = max(abs(A'*(A*x-y))); % ideal ???</span>
0056         <span class="comment">% end</span>
0057 
0058         <span class="comment">% Homotopy method</span>
0059         tic
0060         [xp, gamma_x, iter_xp, t_homotopy1] = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(A, y, tau,4*n); <span class="comment">%BPDN</span>
0061         t_homotopy1 = toc;
0062         tolA_h = tau*sum(abs(xp))+1/2*(norm(A*xp-y))^2;
0063 
0064         <span class="comment">% Adjust tolerance for the objective value, relative to the</span>
0065         <span class="comment">% homotopy solution (which we assume to be accurate!).</span>
0066         pdg_scale = 1e-6;
0067 
0068         tolA = tolA_h+pdg_scale;
0069         stopCri=4;
0070         debias = 0;
0071         x_BB_mono = xp;
0072         t_BB_mono = 0;
0073         first_tau_factor = 0.8*(max(abs(A'*y))/tau);
0074         steps = 5;
0075         
0076         tic;
0077         [x_BB_mono,x_debias_BB_mono,obj_BB_mono,<span class="keyword">...</span>
0078             times_BB_mono,debias_start_BB_mono,mse]= <span class="keyword">...</span>
0079             GPSR_BB(y,A,tau,<span class="keyword">...</span>
0080             <span class="string">'Debias'</span>,debias,<span class="keyword">...</span>
0081             <span class="string">'Monotone'</span>,1,<span class="keyword">...</span>
0082             <span class="string">'Initialization'</span>,0,<span class="keyword">...</span>
0083             <span class="string">'Continuation'</span>,1,<span class="keyword">...</span>
0084             <span class="string">'ContinuationSteps'</span>,steps,<span class="keyword">...</span>
0085             <span class="string">'FirstTauFactor'</span>,first_tau_factor,<span class="keyword">...</span>
0086             <span class="string">'StopCriterion'</span>,stopCri,<span class="keyword">...</span>
0087             <span class="string">'Verbose'</span>, 0,<span class="keyword">...</span>
0088             <span class="string">'True_x'</span>,xp,<span class="keyword">...</span>
0089             <span class="string">'MaxiterA'</span>, 1000,<span class="keyword">...</span>
0090             <span class="string">'ToleranceA'</span>,tolA,<span class="keyword">...</span>
0091             <span class="string">'ToleranceD'</span>,0.001);
0092         t_BB_mono = toc;
0093 
0094         <span class="comment">% FPC</span>
0095         opts.mxitr = 4*n;
0096         opts.f_value_tol = tolA;
0097         M = [];
0098         tic
0099         [x_FPC, Out_FPC] = FPC_AS(n,A,y,tau,M,opts); <span class="comment">% call FPC_AS</span>
0100         t_FPC = toc;
0101         
0102         <span class="comment">% Model the change in signal</span>
0103         dx_model = 1;
0104         <span class="keyword">switch</span> dx_model
0105             <span class="keyword">case</span>  1
0106                 <span class="comment">% Add some elements (T_in) or remove some existing elements (T_out)</span>
0107                 dx  = zeros(n,1);
0108                 T_in = randint(1,1,round(T/20));
0109                 T_out = randint(1,1,round(T/20));
0110                 qin = randperm(n);
0111                 dx(qin(1:T_in)) = (randn(T_in,1));
0112                 qout = randperm(T);
0113                 oldx_indices = q(1:T);
0114                 dx(oldx_indices(qout(1:T_out))) = -x(oldx_indices(qout(1:T_out))).*rand(T_out,1);
0115                 dx(oldx_indices(qout(T_out+1:end))) = randn(T-T_out,1)*.1;
0116             <span class="keyword">case</span>  2;
0117                 <span class="comment">% Perturb the current locations by Gaussian noise</span>
0118                 oldx_indices = q(1:T);
0119                 dx = zeros(n,1);
0120                 dx(oldx_indices) = .1*randn(T,1);
0121                 T_in = 0;
0122                 T_out = 0;
0123             <span class="keyword">otherwise</span>
0124                 disp(<span class="string">'Nooooo'</span>);
0125         <span class="keyword">end</span>
0126         xt = x+dx;
0127         yt = y+A*dx;
0128 
0129         pk_old = A'*(A*xp-y);
0130         AtAgx = A(:,gamma_x)'*A(:,gamma_x);
0131         iAtAgx = inv(AtAgx);
0132 
0133         <span class="comment">% Update using homotopy</span>
0134         tic
0135         [xp_h, gamma_xh, iter_xp_update, t_homotopy_update2] = <a href="DynamicX_BPDN_function.html" class="code" title="function [xp_h, gamma_xh, iter,cpu] = DynamicX_BPDN_function(A, AtAgx, iAtAgx, y, yt, xp, gamma_x, pk, tau, maxiter)">DynamicX_BPDN_function</a>(A, AtAgx, iAtAgx, y, yt, xp, gamma_x, pk_old, tau,4*n);
0136         t_homotopy_update = toc;
0137         tolA_h = tau*sum(abs(xp_h))+1/2*(norm(A*xp_h-yt))^2;
0138 
0139         tic
0140         [xp2, gamma_x2, iter_xp2, t_homotopy2] = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(A, y, tau,4*n); <span class="comment">%BPDN</span>
0141         t_homotopy2 = toc;
0142 
0143         <span class="comment">% % l1_ls</span>
0144         <span class="comment">% [x_l1_ls_update,status,history] = l1_ls(A,yt,2*tau,1e-4);</span>
0145         <span class="comment">% t_l1_ls_update = history(7,end);</span>
0146         <span class="comment">% tolA_ls = history(2,end)/2;</span>
0147 
0148         <span class="comment">% GPSR</span>
0149         tolA = tolA_h+pdg_scale;
0150         stopCri=4;
0151         debias = 0;
0152         <span class="comment">% x_BB_mono = xp;</span>
0153         <span class="comment">% t_BB_mono = 0;</span>
0154         <span class="comment">% PUTTIN CONTINUATION IN HERE MAKES THINGS WORSE</span>
0155         tic;
0156         [x_BB_mono_update,x_debias_BB_mono,obj_BB_mono,<span class="keyword">...</span>
0157             times_BB_mono,debias_start_BB_mono,mse]= <span class="keyword">...</span>
0158             GPSR_BB(yt,A,tau,<span class="keyword">...</span>
0159             <span class="string">'Debias'</span>,debias,<span class="keyword">...</span>
0160             <span class="string">'Monotone'</span>,1,<span class="keyword">...</span>
0161             <span class="string">'Initialization'</span>,x_BB_mono,<span class="keyword">...</span>
0162             <span class="string">'StopCriterion'</span>,stopCri,<span class="keyword">...</span>
0163             <span class="string">'ToleranceA'</span>,tolA,<span class="keyword">...</span>
0164             <span class="string">'True_x'</span>,xp_h,<span class="keyword">...</span>
0165             <span class="string">'MaxiterA'</span>, 1000,<span class="keyword">...</span>
0166             <span class="string">'Verbose'</span>, 0,<span class="keyword">...</span>
0167             <span class="string">'ToleranceD'</span>,0.001);
0168         t_BB_mono_update = toc;
0169         
0170         <span class="comment">% FPC</span>
0171         opts.x0 = x_FPC;
0172         opts.f_value_tol = tolA;
0173         M = [];
0174         tic
0175         [x_FPC_update, Out_FPC_update] = FPC_AS(n,A,yt,tau,M,opts); <span class="comment">% call FPC_AS</span>
0176         t_FPC_update = toc;
0177         
0178         stack_time_solve((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy2 t_homotopy1 t_BB_mono t_FPC];
0179         stack_time_update((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy_update t_BB_mono_update t_FPC_update];
0180         <span class="comment">% New mat files rangTau2 last entry is iteration count for GPSR</span>
0181         stack_iter((out_iter-1)*sim_runs+sim_iter,:) = [iter_xp2 iter_xp_update , length(times_BB_mono), (Out_FPC_update.nProdA+Out_FPC_update.nProdAt)/2 norm(xt-xp_h)/norm(xt) norm(xp_h-x_BB_mono_update)/norm(xp_h) norm(xp_h-x_FPC_update)/norm(xp_h) norm(xt-x_FPC_update)/norm(xt) Out_FPC_update.itr];
0182         [out_iter sim_iter]        
0183     <span class="keyword">end</span>
0184 <span class="keyword">end</span>
0185 
0186 <span class="comment">% Generate table for performance</span>
0187 disp([<span class="string">'       DynamicX          BPDN homotopy           GPSR            FPC_AS'</span>]);
0188 table_stats = zeros(outer_iterations,8);
0189 table_stats(:,3) = mean(reshape(stack_iter(:,1),sim_runs,outer_iterations));
0190 table_stats(:,1) = mean(reshape(stack_iter(:,2),sim_runs,outer_iterations));
0191 table_stats(:,5) = mean(reshape(stack_iter(:,3),sim_runs,outer_iterations));
0192 table_stats(:,7) = mean(reshape(stack_iter(:,4),sim_runs,outer_iterations));
0193 table_stats(:,4) = mean(reshape(stack_time_solve(:,1),sim_runs,outer_iterations));
0194 table_stats(:,2) = mean(reshape(stack_time_update(:,1),sim_runs,outer_iterations));
0195 table_stats(:,6) = mean(reshape(stack_time_update(:,2),sim_runs,outer_iterations));
0196 table_stats(:,8) = mean(reshape(stack_time_update(:,3),sim_runs,outer_iterations))</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>