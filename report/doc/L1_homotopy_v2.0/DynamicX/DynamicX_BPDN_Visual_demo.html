<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of DynamicX_BPDN_Visual_demo</title>
  <meta name="keywords" content="DynamicX_BPDN_Visual_demo">
  <meta name="description" content="Test file for LASSO (BPDN) update with dynamic change in x">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html DynamicX -->
<h1>DynamicX_BPDN_Visual_demo
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Test file for LASSO (BPDN) update with dynamic change in x</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Test file for LASSO (BPDN) update with dynamic change in x</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>	BPDN_homotopy_function.m</li><li><a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/update_inverse.html" class="code" title="function iAtB = update_inverse(AtB, iAtB_old,flag);">update_inverse</a>	function iAtB_mod = update_inverse(AtB, Atb, atB, atb);</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Test file for LASSO (BPDN) update with dynamic change in x</span>
0002 
0003 <span class="comment">% Author: Muhammad Salman Asif @ Georgia Tech</span>
0004 <span class="comment">% E-mail: sasif@ece.gatech.edu</span>
0005 <span class="comment">% Created: November 2008</span>
0006 <span class="comment">% Modified: February 2009</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%-------------------------------------------+</span>
0009 <span class="comment">% Copyright (c) 2009.  Muhammad Salman Asif</span>
0010 <span class="comment">%-------------------------------------------+</span>
0011 
0012 
0013 clear
0014 
0015 <span class="comment">% % load fixed random states</span>
0016 <span class="comment">% load RandomStates</span>
0017 <span class="comment">% rand('state', rand_state);</span>
0018 <span class="comment">% randn('state', randn_state);</span>
0019 
0020 <span class="comment">% signal length</span>
0021 N = 128;
0022 <span class="comment">% number of spikes to put down</span>
0023 T = 20;
0024 <span class="comment">% number of observations to make</span>
0025 M = 64;
0026 
0027 <span class="comment">% random signal supported on q(1:T)</span>
0028 x = zeros(N,1);
0029 q = randperm(N);
0030 
0031 <span class="comment">%N_S = 1: Gaussian signal, N_S = 0: Random signed sequence</span>
0032 N_S = 0;
0033 <span class="keyword">if</span> N_S == 1
0034     x(q(1:T)) = randn(T,1);
0035 <span class="keyword">else</span>
0036     x(q(1:T)) = sign(randn(T,1));
0037 <span class="keyword">end</span>
0038 
0039 <span class="comment">% measurement matrix</span>
0040 <span class="comment">%disp('Creating measurment matrix...');</span>
0041 G = randn(M,N)/sqrt(M);
0042 A = (orth(G'))';
0043 <span class="comment">% A = G;</span>
0044 
0045 <span class="comment">% observations</span>
0046 sigma = .01;
0047 e = randn(M,1)*sigma;
0048 y = A*x + e;
0049 
0050 <span class="comment">% regularization parameter</span>
0051 tau = 1e-2;
0052 
0053 <span class="comment">% Solve for measurements y</span>
0054 t0 = clock;
0055 [xp, gamma_x, xp_iter, xp_time] = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(A, y, tau,4*N); <span class="comment">%BPDN</span>
0056 t1 = clock;
0057 t0_1 = etime(t1,t0);
0058 
0059 <span class="comment">% Model the change in signal</span>
0060 dx_model = 1; <span class="comment">% 0 - Perturb only non-zero locations</span>
0061               <span class="comment">% 1 - Add some new elements (T_in) and remove some existing</span>
0062               <span class="comment">% elements (T_out)</span>
0063 <span class="keyword">switch</span> dx_model
0064     <span class="keyword">case</span>  1
0065         <span class="comment">% Add some elements (T_in) or remove some existing elements (T_out)</span>
0066         dx  = zeros(N,1);
0067         dx(q(1:T)) = randn*.1;
0068         T_in = round(T/20);
0069         T_out = round(T/20);
0070         qin = randperm(N);
0071 
0072         dx(qin(1:T_in)) = (randn(T_in,1));
0073 
0074         qout = randperm(T);
0075         oldx_indices = q(1:T);
0076         dx(oldx_indices(qout(1:T_out))) = -x(oldx_indices(qout(1:T_out)));
0077 
0078     <span class="keyword">case</span>  2;
0079         <span class="comment">% Perturb the current locations by Gaussian noise</span>
0080         oldx_indices = q(1:T);
0081         dx = zeros(N,1);
0082         dx(oldx_indices) = randn(T,1)*.2;
0083     <span class="keyword">otherwise</span>
0084         disp(<span class="string">'Nooooo'</span>);
0085 <span class="keyword">end</span>
0086 
0087 xt = x+dx;
0088 yt = y+A*dx;
0089 
0090 epsilon = 0;
0091 e0 = 0;
0092 xp2_h = xp;
0093 gamma_xh = gamma_x;
0094 itheta = [];
0095 
0096 done = 0;
0097 iter = 0;
0098 pk_old = A'*(A*xp-y);
0099 AtAgx = A(:,gamma_xh)'*A(:,gamma_xh);
0100 iAtAgx = inv(AtAgx);
0101 
0102 tu0 = clock;
0103 <span class="keyword">while</span> ~done
0104     iter = iter +1 ;
0105 
0106     <span class="comment">%%% NEED UPDATE</span>
0107     <span class="comment">% iAtAgx = inv(A(:,gamma_xh)'*A(:,gamma_xh));</span>
0108 
0109     d = A(:,gamma_xh)'*(-y+yt);
0110     delx = iAtAgx*d;
0111     pk = pk_old;
0112     dk = A'*(A(:,gamma_xh)*delx+y-yt);
0113     delx_vec = zeros(N,1);
0114     delx_vec(gamma_xh) = delx;
0115 
0116     temp_gamma = zeros(N,1);
0117     temp_gamma(gamma_xh) = gamma_xh;
0118     gamma_xc = find([1:N]' ~= temp_gamma);
0119     <span class="comment">% gamma_xc = setdiff([1:N],[gamma_xh]);</span>
0120 
0121     b_constr1 = (tau-pk(gamma_xc))./dk(gamma_xc);
0122     b_constr2 = (tau+pk(gamma_xc))./-dk(gamma_xc);
0123     b_constr3 = (-xp2_h(gamma_xh)./delx_vec(gamma_xh));
0124     itheta_1 = find(b_constr1&gt;2*eps);
0125     itheta_2 = find(b_constr2&gt;2*eps);
0126     itheta_3 = find(b_constr3&gt;2*eps);
0127     theta1 = min(b_constr1(itheta_1));
0128     theta2 = min(b_constr2(itheta_2));
0129     theta3 = min(b_constr3(itheta_3));
0130     <span class="keyword">if</span> theta1&gt;theta2
0131         theta = theta2;
0132         itheta = gamma_xc(find(b_constr2==theta2));
0133         flag = 1;
0134     <span class="keyword">else</span>
0135         theta = theta1;
0136         itheta = gamma_xc(find(b_constr1==theta1));
0137         flag = 1;
0138     <span class="keyword">end</span>
0139     <span class="keyword">if</span> theta3 &lt; theta
0140         theta = theta3;
0141         itheta = gamma_xh(find(b_constr3==theta3));
0142         flag = 0;
0143 
0144     <span class="keyword">end</span>
0145     <span class="comment">%     if flag == 0</span>
0146     <span class="comment">%         [epsilon+theta theta itheta flag xp2_h(itheta) delx_vec(itheta)]</span>
0147     <span class="comment">%     else</span>
0148     <span class="comment">%         [epsilon+theta theta itheta flag pk(itheta) dk(itheta)]</span>
0149     <span class="comment">%     end</span>
0150     
0151     epsilon = (theta+e0);
0152     <span class="keyword">if</span> epsilon &lt; 0
0153         epsilon= inf;
0154     <span class="keyword">end</span>
0155     gamma_xh_old = gamma_xh;
0156     xp2_old = xp2_h;
0157     xp2_h = xp2_h+theta*delx_vec;
0158     <span class="keyword">if</span> flag == 1
0159         AtgxAnx = A(:,gamma_xh)'*A(:,itheta);
0160         AtAgx_mod = [AtAgx AtgxAnx; AtgxAnx' A(:,itheta)'*A(:,itheta)];
0161 
0162         iAtAgx = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/update_inverse.html" class="code" title="function iAtB = update_inverse(AtB, iAtB_old,flag);">update_inverse</a>(AtAgx_mod, iAtAgx,1);
0163         AtAgx = AtAgx_mod;
0164 
0165         gamma_xh = [gamma_xh; itheta];
0166         xp2_h(itheta) = 0;
0167     <span class="keyword">else</span>
0168         outx_index = find(gamma_xh==itheta);
0169         gamma_xh(outx_index) = gamma_xh(end);
0170         gamma_xh(end) = itheta;
0171         gamma_xh = gamma_xh(1:end-1);
0172 
0173         rowi = outx_index; <span class="comment">% ith row of A is swapped with last row (out_x)</span>
0174         colj = outx_index; <span class="comment">% jth column of A is swapped with last column (out_x)</span>
0175         AtAgx_ij = AtAgx;
0176         temp_row = AtAgx_ij(rowi,:);
0177         AtAgx_ij(rowi,:) = AtAgx_ij(<span class="keyword">end</span>,:);
0178         AtAgx_ij(<span class="keyword">end</span>,:) = temp_row;
0179         temp_col = AtAgx_ij(:,colj);
0180         AtAgx_ij(:,colj) = AtAgx_ij(:,end);
0181         AtAgx_ij(:,end) = temp_col;
0182         iAtAgx_ij = iAtAgx;
0183         temp_row = iAtAgx_ij(colj,:);
0184         iAtAgx_ij(colj,:) = iAtAgx_ij(<span class="keyword">end</span>,:);
0185         iAtAgx_ij(<span class="keyword">end</span>,:) = temp_row;
0186         temp_col = iAtAgx_ij(:,rowi);
0187         iAtAgx_ij(:,rowi) = iAtAgx_ij(:,end);
0188         iAtAgx_ij(:,end) = temp_col;
0189 
0190         AtAgx = AtAgx_ij(1:end-1,1:end-1);
0191         iAtAgx = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/update_inverse.html" class="code" title="function iAtB = update_inverse(AtB, iAtB_old,flag);">update_inverse</a>(AtAgx_ij, iAtAgx_ij,2);
0192 
0193         xp2_h(itheta) = 0;
0194     <span class="keyword">end</span>
0195 
0196     <span class="comment">%[epsilon theta itheta flag]</span>
0197     <span class="comment">%     itheta_stack = [itheta_stack; itheta];</span>
0198     <span class="comment">%     flag_stack = [flag_stack; flag];</span>
0199 
0200     <span class="keyword">if</span> epsilon &gt;=1
0201         theta_end = (1-e0);
0202         xp2_h = xp2_old + theta_end*delx_vec;
0203         gamma_xh = gamma_xh_old;
0204         epsilon = 1;
0205         disp(<span class="string">'done!'</span>);
0206         <span class="keyword">break</span>;
0207     <span class="keyword">end</span>
0208 
0209     e0 = (theta+e0);
0210 
0211     pk_old = pk+theta*dk;
0212     pk_old([gamma_xh; itheta]) = sign(pk_old([gamma_xh; itheta]))*tau;
0213 
0214     figure(2);
0215     subplot(2,1,1);
0216     hold off;
0217     plot(pk,<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,14);
0218     hold on;
0219     plot(pk_old, <span class="string">'LineWidth'</span>,1);
0220 
0221     <span class="keyword">if</span> flag == 1
0222         plot(itheta, pk_old(itheta),<span class="string">'or'</span>,<span class="string">'MarkerSize'</span>,18, <span class="string">'LineWidth'</span>,2);
0223         text(itheta,pk_old(itheta)*1.2, [<span class="string">'Incoming \gamma = '</span>,num2str(itheta)],<span class="string">'FontSize'</span>,14);
0224     <span class="keyword">else</span>
0225         plot(itheta, pk_old(itheta),<span class="string">'*k'</span>,<span class="string">'MarkerSize'</span>,18, <span class="string">'LineWidth'</span>,2);
0226         text(itheta,pk_old(itheta)*1.2, [<span class="string">'Outgoing \gamma = '</span>,num2str(itheta)],<span class="string">'FontSize'</span>,14);
0227     <span class="keyword">end</span>
0228     set(gca,<span class="string">'FontSize'</span>,16, <span class="string">'XLim'</span>,[1 N] );
0229     title(<span class="string">'BPDN shrinkage constraints'</span>);
0230     <span class="comment">%legend('Old constraint', 'New constraint', 'Element change','Location','NorthEast');</span>
0231     title([<span class="string">'BPDN constraints, n = '</span>,num2str(N), <span class="string">', m = '</span>, num2str(M), <span class="string">', T = '</span>, num2str(T), <span class="string">', Tin = '</span>, num2str(T_in)]);
0232     plot(1:N, tau*ones(1,N),<span class="string">'--k'</span>);
0233     plot(1:N, -tau*ones(1,N), <span class="string">'--k'</span>);
0234     axis([1 N -tau*1.5 tau*1.5])
0235 
0236     figure(2);
0237     subplot(2,1,2)
0238     hold off
0239     plot(xp2_old,<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,14); hold on;
0240     plot(xp2_h,<span class="string">'LineWidth'</span>,1);
0241     set(gca,<span class="string">'FontSize'</span>,16,<span class="string">'XLim'</span>,[1 N]);
0242     title({[<span class="string">'BPDN estimate at \epsilon = '</span>,num2str(epsilon),<span class="string">', Iteration count = '</span>,num2str(iter)]});
0243     <span class="keyword">if</span> flag == 0
0244         plot(itheta, 0,<span class="string">'ok'</span>, <span class="string">'MarkerSize'</span>,18,<span class="string">'LineWidth'</span>,2);
0245     <span class="keyword">else</span>
0246         plot(itheta, 0,<span class="string">'or'</span>, <span class="string">'MarkerSize'</span>,18,<span class="string">'LineWidth'</span>,2);
0247     <span class="keyword">end</span>
0248     drawnow;
0249     <span class="comment">% pause;</span>
0250 
0251     <span class="comment">%print(gcf,'-dbmp','-r200',['BPDNPath_',num2str(iter)])</span>
0252 <span class="keyword">end</span>
0253 figure(2);
0254 subplot(2,1,1);
0255 hold off;
0256 plot(pk,<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,14);
0257 hold on;
0258 plot(pk_old, <span class="string">'LineWidth'</span>,1);
0259 
0260 
0261 set(gca,<span class="string">'FontSize'</span>,16, <span class="string">'XLim'</span>,[1 N] );
0262 title(<span class="string">'BPDN shrinkage constraints'</span>);
0263 <span class="comment">%legend('Old constraint', 'New constraint', 'Element change','Location','NorthEast');</span>
0264 title([<span class="string">'BPDN constraints, n = '</span>,num2str(N), <span class="string">', m = '</span>, num2str(M), <span class="string">', T = '</span>, num2str(T), <span class="string">', Tin = '</span>, num2str(T_in)]);
0265 plot(1:N, tau*ones(1,N),<span class="string">'--k'</span>);
0266 plot(1:N, -tau*ones(1,N), <span class="string">'--k'</span>);
0267 axis([1 N -tau*1.5 tau*1.5])
0268 
0269 figure(2);
0270 subplot(2,1,2)
0271 hold off
0272 plot(xp2_old,<span class="string">'.r'</span>,<span class="string">'MarkerSize'</span>,14); hold on;
0273 plot(xp2_h,<span class="string">'LineWidth'</span>,1);
0274 set(gca,<span class="string">'FontSize'</span>,16,<span class="string">'XLim'</span>,[1 N]);
0275 title({[<span class="string">'BPDN estimate at \epsilon = '</span>,num2str(epsilon),<span class="string">', Iteration count = '</span>,num2str(iter)]});
0276 drawnow;</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>