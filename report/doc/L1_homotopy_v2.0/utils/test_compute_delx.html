<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_compute_delx</title>
  <meta name="keywords" content="test_compute_delx">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html utils -->
<h1>test_compute_delx
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="compute_delx.html" class="code" title="function out = compute_delx(in,A)">compute_delx</a>	This function solves a system of the form A^TA delx = z.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 clear;
0002 addpath qr/
0003 
0004 N = 512;
0005 M = 256;
0006 maxiter = 500;
0007 
0008 rseed = sum(100*clock);
0009 rseed = 0;
0010 <span class="comment">% rand('state',rseed);</span>
0011 <span class="comment">% randn('state',rseed);</span>
0012 RandStream.setDefaultStream(RandStream(<span class="string">'mt19937ar'</span>,<span class="string">'seed'</span>,rseed));
0013 
0014 O = randn(M,N); 
0015 W = diag(rand(N,1)); W = diag(ones(N,1));
0016 A = O*W;
0017 AtA = A'*A;
0018 z = (randn(N,1));
0019 
0020 T_init = 250;
0021 q = randperm(N)';
0022 Gamma = q(1:T_init); 
0023 delx = (A(:,Gamma)'*A(:,Gamma))\z(Gamma);
0024 
0025 <span class="comment">% MIL initialize</span>
0026 iAtA = zeros(T_init,T_init);
0027 iAtA(1:T_init,1:T_init) = inv(A(:,Gamma)'*A(:,Gamma));
0028 delx_mil = delx;
0029 t_mil = 0;
0030 
0031 <span class="comment">% MGS qr update initialize</span>
0032 <span class="comment">% Q = zeros(M,M); R = zeros(M,M);</span>
0033 Q = zeros(M,M); 
0034 [Q R] = qr(A(:,Gamma),0);
0035 delx_qr = delx;
0036 t_qr = 0;
0037 
0038 <span class="comment">% qrupdate matlab initialize</span>
0039 [Q0 R0] = qr(A(:,Gamma)); <span class="comment">% Q0 = 1; R0 = ata;</span>
0040 delx_qrM = delx;
0041 t_qrM = 0;
0042 
0043 <span class="comment">% CG initialize</span>
0044 delx_cg = delx;
0045 t_cg = 0;
0046 
0047 <span class="comment">% Run with following options</span>
0048 mil = 1;
0049 qr_g = 1;
0050 qrM = 1;
0051 cg = 1;
0052 error = 1;
0053 in = [];
0054 Gamma_new = Gamma;
0055 
0056 <span class="keyword">for</span> itr = 1:maxiter;
0057     
0058     Gamma = Gamma_new;
0059     GammaC = setdiff(1:N,Gamma);
0060     T = length(Gamma);
0061     <span class="keyword">if</span> T == 1
0062         add_rem = 1;
0063     <span class="keyword">elseif</span> T == M
0064         toss = rand;
0065         add_rem = (toss&gt;0.5)*2;
0066     <span class="keyword">else</span>
0067         add_rem = rand&gt;0;
0068     <span class="keyword">end</span>
0069     
0070     <span class="keyword">switch</span> add_rem
0071         <span class="keyword">case</span> 1
0072             ind_i = floor(rand(1,1)*(N-T))+1;
0073             new_x = GammaC(ind_i);
0074             Gamma_new = [Gamma; new_x];
0075             
0076             in.new_x = new_x;
0077             in.add_rem = 1;
0078         <span class="keyword">case</span> 0
0079             out_i = floor(rand(1,1)*(T))+1;
0080             out_x = Gamma(out_i);
0081             
0082             <span class="comment">% Shift columns to the left (preferred)</span>
0083             out_loc = Gamma==out_x;
0084             Gamma = Gamma(~out_loc);
0085             Gamma = [Gamma; out_x];
0086             new_order = [1:out_i-1, out_i+1:T, out_i]';
0087             
0088             
0089             <span class="comment">%         % Swap the outgoing column with the last one</span>
0090             <span class="comment">%         Gamma(out_loc) = Gamma(end);</span>
0091             <span class="comment">%         Gamma(end) = out_x;</span>
0092             <span class="comment">%         if out_i == T</span>
0093             <span class="comment">%             new_order = [1:out_i-1, T]';</span>
0094             <span class="comment">%         else</span>
0095             <span class="comment">%             new_order = [1:out_i-1, T, out_i+1:T-1, out_i]';</span>
0096             <span class="comment">%         end</span>
0097             
0098             Gamma_new = Gamma(1:end-1);
0099             
0100             in.new_order = new_order;
0101             in.out_i = out_i;
0102             in.add_rem = 0;
0103         <span class="keyword">case</span> 2
0104             out_i = floor(rand(1,1)*(T))+1;
0105             out_x = Gamma(out_i);
0106             
0107             ind_i = floor(rand(1,1)*(N-T))+1;
0108             new_x = GammaC(ind_i);
0109             
0110             <span class="comment">% Shift columns to the left (preferred)</span>
0111             out_loc = Gamma==out_x;
0112             Gamma = Gamma(~out_loc);
0113             Gamma = [Gamma; out_x];
0114             new_order = [1:out_i-1, out_i+1:T, out_i]';
0115             
0116             Gamma_new = [Gamma(1:end-1); new_x];
0117 
0118             in.new_order = new_order;
0119             in.out_i = out_i;
0120             in.new_x = new_x;
0121             in.add_rem = 2;
0122     <span class="keyword">end</span>
0123     
0124     
0125     <span class="comment">%% True direction</span>
0126     <span class="keyword">if</span> error
0127         AtA = (A(:,Gamma_new)'*A(:,Gamma_new));
0128         delx = AtA\z(Gamma_new);
0129     <span class="keyword">end</span>
0130     
0131     in.Gamma = Gamma;
0132     in.rhs = z;
0133     in.itr = itr;
0134     
0135     <span class="comment">%% MIL update</span>
0136     <span class="keyword">if</span> mil
0137         t = tic; <span class="comment">% t = cputime;</span>
0138         
0139         <span class="keyword">if</span> in.add_rem == 0
0140             
0141         <span class="keyword">end</span>
0142         
0143         in.iAtA = iAtA;
0144         in.delx = delx_mil;
0145         in.type = <span class="string">'mil'</span>;
0146         in.M = M;
0147         out = <a href="compute_delx.html" class="code" title="function out = compute_delx(in,A)">compute_delx</a>(in,A);
0148         delx_mil = out.delx;
0149         iAtA = out.iAtA;
0150         
0151         t1 = toc(t); <span class="comment">% t1 = cputime-t;</span>
0152         t_mil = t_mil+t1;
0153     <span class="keyword">end</span>
0154     
0155     <span class="comment">%% qr update with Givens rotation for deleting a column</span>
0156     <span class="keyword">if</span> qr_g
0157         <span class="comment">% Update QR using Givens roation</span>
0158         t=tic; <span class="comment">% t = cputime;</span>
0159         
0160         in.R = R;
0161         in.Q = Q;
0162         in.nre = 2;
0163         in.delx = delx_qr;
0164         in.type = <span class="string">'qr'</span>;
0165         out = <a href="compute_delx.html" class="code" title="function out = compute_delx(in,A)">compute_delx</a>(in,A);
0166         R = out.R;
0167         Q = out.Q;
0168         delx_qr = out.delx;
0169         
0170         t1 = toc(t); <span class="comment">% t1 = cputime-t;</span>
0171         t_qr = t_qr+t1;
0172         
0173         orth_err = Q'*Q-eye(size(Q,2));
0174         <span class="comment">% figure(1); plot(vec(orth_err));  shg</span>
0175         <span class="keyword">if</span> norm(orth_err(:)) &gt; 1e-3
0176             error(<span class="string">'reorthogonalize...'</span>);
0177         <span class="keyword">end</span>
0178     <span class="keyword">end</span>
0179     
0180     <span class="comment">%% matlab qr update</span>
0181     <span class="keyword">if</span> qrM
0182         t=tic; <span class="comment">% t = cputime;</span>
0183         
0184         in.R0 = R0;
0185         in.Q0 = Q0;
0186         in.delx = delx_qrM;
0187         in.type = <span class="string">'qrM'</span>;
0188         out = <a href="compute_delx.html" class="code" title="function out = compute_delx(in,A)">compute_delx</a>(in,A);
0189         R0 = out.R0;
0190         Q0 = out.Q0;
0191         delx_qrM = out.delx;
0192         
0193         t1 = toc(t); <span class="comment">% t1 = cputime-t;</span>
0194         t_qrM = t_qrM+t1;
0195     <span class="keyword">end</span>
0196     
0197     <span class="comment">%% CG update</span>
0198     <span class="keyword">if</span> cg
0199         t=tic; <span class="comment">% t = cputime;</span>
0200         
0201         in.delx = delx_cg;
0202         in.type = <span class="string">'cg'</span>;
0203         out = <a href="compute_delx.html" class="code" title="function out = compute_delx(in,A)">compute_delx</a>(in,A);
0204         delx_cg = out.delx;
0205         
0206         t1 = toc(t); <span class="comment">% t1 = cputime-t;</span>
0207         t_cg= t_cg+t1;
0208     <span class="keyword">end</span>
0209     
0210     
0211     <span class="keyword">if</span> error
0212         fprintf(<span class="string">'iter=%d, T=%d, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g, t_cg=%3.4g, errors: mil=%3.4g, qr=%3.4g, qrM=%3.4g, cg=%3.4g.\n'</span>,itr, T,t_mil, t_qr, t_qrM, t_cg, norm(delx-delx_mil), norm(delx-delx_qr), norm(delx-delx_qrM),norm(delx-delx_cg));
0213     <span class="keyword">else</span>
0214         fprintf(<span class="string">'iter=%d, T=%d, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g, t_cg=%3.4g. \n'</span>,itr, T, t_mil, t_qr, t_qrM, t_cg);
0215     <span class="keyword">end</span>
0216     pause(1/60)
0217 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>