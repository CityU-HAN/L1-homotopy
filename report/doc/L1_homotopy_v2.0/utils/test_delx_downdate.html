<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_delx_downdate</title>
  <meta name="keywords" content="test_delx_downdate">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html utils -->
<h1>test_delx_downdate
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="givens.html" class="code" title="function [c s] = givens(a,b)">givens</a>	Givens plane rotation [c s;-s c]. Entries c and s</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 clear;
0002 
0003 N = 1000;
0004 S = 300;
0005 
0006 rseed = sum(100*clock);
0007 <span class="comment">% rseed = 0;</span>
0008 <span class="comment">% rand('state',rseed);</span>
0009 <span class="comment">% randn('state',rseed);</span>
0010 RandStream.setDefaultStream(RandStream(<span class="string">'mt19937ar'</span>,<span class="string">'seed'</span>,rseed));
0011 
0012 A = (randn(N,S));
0013 AtA = A'*A;
0014 z = sign(randn(S,1));
0015 
0016 
0017 <span class="comment">% MIL initialize</span>
0018 iAtA = inv(A'*A);
0019 delx_mil = iAtA*z;
0020 t_mil = 0;
0021 
0022 <span class="comment">% Givens-rotation qr update initialize</span>
0023 [Q R] = qr(A,0);
0024 <span class="comment">% [Q1 R1] = Givred(A);</span>
0025 <span class="comment">% [Q2 R2] = qr_givens(A);</span>
0026 delx_qr = R\(R'\z);
0027 t_qr = 0;
0028 
0029 <span class="comment">% qrupdate matlab infitialize</span>
0030 [Q0 R0] = qr(A); <span class="comment">% Q0 = 1; R0 = ata;</span>
0031 delx_qrM = 0;
0032 t_qrM = 0;
0033 
0034 <span class="comment">% Run the active ones</span>
0035 mil = 1;
0036 qr_giv = 1;
0037 qrM = 0;
0038 error = 1;
0039 
0040 Gamma = [1:S]';
0041 Gamma_new = Gamma;
0042 
0043 <span class="keyword">for</span> ii = S-1:-1:2
0044     
0045     Gamma = Gamma_new;
0046     out_i = floor(rand(1,1)*(ii))+1;
0047     out_x = Gamma(out_i);
0048     
0049     <span class="comment">% How to remove the column</span>
0050     swap_shift = 0;
0051     <span class="keyword">if</span> swap_shift
0052         <span class="comment">% Swap last column with outgoing column</span>
0053         Gamma(out_i) = Gamma(end);
0054         <span class="comment">% Gamma = Gamma(1:end-1);</span>
0055         new_order = [1:out_i-1, ii+1, out_i+1:ii, out_i]';
0056     <span class="keyword">else</span>
0057         <span class="comment">% Shift columns to the left (preferred)</span>
0058         out_loc = Gamma==out_x;
0059         Gamma = Gamma(~out_loc);
0060         Gamma = [Gamma; out_x];
0061         new_order = [1:out_i-1, out_i+1:ii+1, out_i]';
0062     <span class="keyword">end</span>
0063     Gamma_new = Gamma(1:end-1);
0064     <span class="comment">%% True direction</span>
0065     <span class="keyword">if</span> error
0066         AtA = (A(:,Gamma(1:end-1))'*A(:,Gamma(1:end-1)));
0067         delx = AtA\z(Gamma(1:end-1));
0068     <span class="keyword">end</span>
0069     
0070     <span class="comment">%% MIL update</span>
0071     <span class="keyword">if</span> mil
0072         tic; t = cputime;
0073         iAtA = iAtA(new_order,new_order);
0074         Si = 1/iAtA(ii+1,ii+1);
0075         at = [iAtA(1:ii,ii+1)*sqrt(Si); 1/sqrt(Si)];
0076         ab = at(1:ii);
0077         alpha = at'*z(Gamma);
0078         delx_mil = delx_mil(new_order);
0079         delx_mil = delx_mil(1:ii)-alpha*ab;
0080         iAtA = iAtA(1:ii,1:ii)-ab*ab';
0081         <span class="comment">% delx_mil = iAtA*z(Gamma);</span>
0082         t1 = cputime-t;
0083         t1 = toc;
0084         t_mil = t_mil+t1;
0085     <span class="keyword">end</span>
0086     
0087     <span class="comment">%% qr update with Givens rotation for deleting a column</span>
0088     <span class="keyword">if</span> qr_giv
0089         <span class="comment">% Update QR using Givens roation</span>
0090         R_old = R; Q_old = Q;
0091         Q = Q';
0092         tic; t = cputime;
0093         R = [R(:,new_order)];
0094         
0095         <span class="comment">% if swap_shift</span>
0096         <span class="comment">%     % Make into Hessenberg and then perform another updating</span>
0097         <span class="comment">%     % (Do not swap the columns, work directly with the Hessenberg form below)</span>
0098         <span class="comment">%     for i = ii+1:-1:out_i</span>
0099         <span class="comment">%         j = i-1;</span>
0100         <span class="comment">%         [c, s] = givens(R(j,out_i), R(i,out_i));</span>
0101         <span class="comment">%         R([j i],out_i:end) = [c s; -s c]'*R([j i],out_i:end);</span>
0102         <span class="comment">%         %Q([j i],:) = [c s; -s c]'*Q([j i],:);</span>
0103         <span class="comment">%     end</span>
0104         <span class="comment">% end</span>
0105         <span class="keyword">for</span> j = out_i:ii
0106             i = j+1;
0107             [c, s] = <a href="givens.html" class="code" title="function [c s] = givens(a,b)">givens</a>(R(j,j), R(i,j));
0108             R([j i],j:end) = [c -s; s c]*R([j i],j:end);
0109             Q([j i],:) = [c -s; s c]*Q([j i],:);
0110         <span class="keyword">end</span>
0111         ri = R\[zeros(ii,1); 1];
0112         delx_qr = delx_qr(new_order);
0113         delx_qr_simple = delx_qr-(ri'*z(Gamma))*ri;
0114         delx_qr = delx_qr_simple(1:end-1);
0115         
0116         R = R(1:ii,1:ii);
0117         <span class="comment">% Rt = R';</span>
0118         <span class="comment">% delx_qr = R\(Rt\z(Gamma));</span>
0119         
0120         t1 = cputime-t;
0121         t1 = toc;
0122         t_qr = t_qr+t1;
0123         R = triu(R); Q = Q(1:ii,:); Q = Q';
0124         
0125     <span class="keyword">end</span>
0126     
0127     <span class="comment">%% matlab qr update</span>
0128     <span class="keyword">if</span> qrM
0129         tic; t = cputime;
0130         <span class="comment">%         Q0t = [Q0 zeros(ii-1,1); zeros(1,ii-1) 1];</span>
0131         <span class="comment">%         R0t = [R0 zeros(ii-1,1); zeros(1,ii-1) 1];</span>
0132         <span class="comment">%         loc_vector = zeros(ii,1);</span>
0133         <span class="comment">%         loc_vector(end) = 1;</span>
0134         <span class="comment">%         ai = A(:,ii);</span>
0135         <span class="comment">%         Ata = A(:,1:ii-1)'*ai;</span>
0136         <span class="comment">%         rep_row = [Ata; ai'*ai]; % adds the new row to A'A</span>
0137         <span class="comment">%         [Q2t R2t] = qrupdate(Q0t, R0t, loc_vector, rep_row);</span>
0138         <span class="comment">%         rep_vec = [Ata; -1]; % adds remaining part of the column in A'A and removes the 1 introduced in the beginning.</span>
0139         <span class="comment">%         delx_qrM = R0\(Q0'*z(1:ii));</span>
0140         
0141         <span class="comment">%         [Q0 R0] = qrupdate(Q2t, R2t, rep_vec, loc_vector);</span>
0142         [Q0, R0] = qrdelete(Q0,R0, out_i, <span class="string">'col'</span>);
0143         R0t = R0';
0144         delx_qrM = (R0\(R0t\z(Gamma(1:end-1))));
0145         t1 = cputime-t;
0146         t1 = toc;
0147         t_qrM = t_qrM+t1;
0148     <span class="keyword">end</span>
0149     
0150 <span class="keyword">end</span>
0151 
0152 <span class="keyword">if</span> error
0153     fprintf(<span class="string">'iter=%d, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g, errors: mil=%3.4g, qr=%3.4g, qrM=%3.4g.\n'</span>,ii, t_mil, t_qr, t_qrM, norm(delx-delx_mil), norm(delx-delx_qr), norm(delx-delx_qrM));
0154 <span class="keyword">else</span>
0155     fprintf(<span class="string">'iter=%d, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g.\n'</span>,ii, t_mil, t_qr, t_qrM);
0156 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>