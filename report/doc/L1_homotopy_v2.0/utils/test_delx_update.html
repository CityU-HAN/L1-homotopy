<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of test_delx_update</title>
  <meta name="keywords" content="test_delx_update">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html utils -->
<h1>test_delx_update
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 clear;
0002 
0003 N = 1000;
0004 S = 500;
0005 
0006 rseed = sum(100*clock);
0007 <span class="comment">% rseed = 0;</span>
0008 <span class="comment">% rand('state',rseed);</span>
0009 <span class="comment">% randn('state',rseed);</span>
0010 RandStream.setDefaultStream(RandStream(<span class="string">'mt19937ar'</span>,<span class="string">'seed'</span>,rseed));
0011 
0012 A = (randn(N,S));
0013 AtA = A'*A;
0014 z = sign(randn(S,1));
0015 
0016 <span class="comment">% R-CGS initialize</span>
0017 <span class="comment">% Ri = zeros(S,S);</span>
0018 ata = A(:,1)'*A(:,1);
0019 Ri(1,1) = 1/sqrt(ata);
0020 delx_cgs = z(1,1)/ata;
0021 t_cgs = 0;
0022 
0023 <span class="comment">% MIL initialize</span>
0024 iAtA = zeros(1,1);
0025 <span class="comment">%iAtA = sparse(iAtA);</span>
0026 iAtA(1,1) = 1/ata;
0027 delx_mil = z(1,1)/ata;
0028 t_mil = 0;
0029 
0030 <span class="comment">% MGS qr update initialize</span>
0031 Q = zeros(N,S); R = zeros(S,S);
0032 Q(:,1) = A(:,1)/norm(A(:,1)); R(1,1) = norm(A(:,1));
0033 delx_qr = z(1,1)/ata;
0034 t_qr = 0;
0035 
0036 <span class="comment">% qrupdate matlab initialize</span>
0037 [Q0 R0] = qr(A(:,1)); <span class="comment">% Q0 = 1; R0 = ata;</span>
0038 delx_qrM = z(1,1)/ata;
0039 t_qrM = 0;
0040 
0041 <span class="comment">% Run the active ones</span>
0042 qr_cgs = 0;
0043 mil = 1;
0044 qr_gs = 1; 
0045 qrM = 0;
0046 error = 0;
0047 
0048 <span class="keyword">for</span> ii = 2:S
0049     <span class="comment">%% True direction</span>
0050     <span class="keyword">if</span> error
0051         AtA = (A(:,1:ii)'*A(:,1:ii));
0052         delx = AtA\z(1:ii);
0053     <span class="keyword">end</span>
0054     
0055     <span class="comment">%% R factor CGS</span>
0056     <span class="keyword">if</span> qr_cgs
0057         tic; t = cputime;
0058         ai = A(:,ii);
0059         Ata = A(:,1:ii-1)'*ai;
0060         <span class="comment">% Pai = Ri(1:ii-1,1:ii-1)*(Ri(1:ii-1,1:ii-1)'*Ata);</span>
0061         Pai = Ri*(Ri'*Ata);
0062         Si = ai'*ai-Ata'*Pai;
0063         at = [-Pai; 1]/sqrt(Si);
0064         <span class="comment">% Ri(1:ii,ii) = at;</span>
0065         Ri = [[Ri; zeros(1,ii-1)] at];
0066         alpha = at'*z(1:ii);
0067         delx_cgs = [delx_cgs;0]+ alpha*at;
0068         t1 = cputime-t;
0069         t1 = toc;
0070         t_cgs = t_cgs+t1;
0071     <span class="keyword">end</span>
0072     <span class="comment">%     RiRit = Ri(1:ii,1:ii)*Ri(1:ii,1:ii)';</span>
0073     <span class="comment">%     fprintf('iter=%d, ||delx-delx-cg||_2=%3.4g, ||iAtA-RiRiT||_2=%3.4g.\n',ii, norm(delx-delx_cgs), norm(iAtAgx-RiRit));</span>
0074     
0075     <span class="comment">%% MIL update</span>
0076     <span class="keyword">if</span> mil
0077         tic; t = cputime;
0078         ai = A(:,ii);
0079         Ata = A(:,1:ii-1)'*ai; 
0080         Pai = iAtA*Ata;
0081         Si = ai'*ai-Ata'*Pai;
0082         at = [-Pai; 1]/sqrt(Si);
0083         alpha = at'*z(1:ii);
0084         delx_mil = [delx_mil;0]+ alpha*at;
0085         iAtA = [iAtA zeros(ii-1,1); zeros(1,ii)] + at*at';
0086         
0087         <span class="comment">% Ata = zeros(S,1);</span>
0088         <span class="comment">% Gamma = 1:ii-1;</span>
0089         <span class="comment">% Ata(Gamma) = A(:,1:ii-1)'*ai;</span>
0090         <span class="comment">% at = -Pai/sqrt(Si);</span>
0091         <span class="comment">% at(ii) = 1/sqrt(Si);</span>
0092         <span class="comment">% at = sparse(at);</span>
0093         <span class="comment">% alpha = at'*z;</span>
0094         <span class="comment">% delx_mil = delx_mil+ alpha*at;</span>
0095         <span class="comment">% iAtA  = iAtA+at*at';</span>
0096         
0097         t1 = cputime-t;
0098         t1 = toc;
0099         t_mil = t_mil+t1;
0100     <span class="keyword">end</span>
0101     
0102     <span class="comment">%% qr update with MGS for appending a column.</span>
0103     <span class="keyword">if</span> qr_gs
0104         <span class="comment">% compute QR using Gram-Schmidt</span>
0105         tic; t = cputime;
0106         ai = A(:,ii);
0107         v = ai;
0108         <span class="keyword">for</span> i=1:ii-1
0109             R(i,ii) = Q(:,i)'*v; <span class="comment">% change ai to v for MGS...</span>
0110             v = v - R(i,ii)*Q(:,i); <span class="comment">% subtract the projection (q_j'a_j)q_j = (q_j'v)q_j!</span>
0111         <span class="keyword">end</span>
0112         <span class="comment">% pj = (Q(:,1:ii-1)'*ai);</span>
0113         <span class="comment">% R(1:ii-1,ii) = pj;</span>
0114         <span class="comment">% w = ai-Q(:,1:ii-1)*pj;</span>
0115         R(ii,ii) = norm(v);
0116         Q(:,ii) = v/R(ii,ii);
0117          <span class="comment">% Rc = R(1:ii,1:ii);</span>
0118         <span class="comment">% Rct = Rc';</span>
0119         <span class="comment">% delx_qr = Rc\(Rct\z(1:ii));</span>
0120         ri = R(1:ii,1:ii)\[zeros(ii-1,1); 1];
0121         delx_qr = [delx_qr; 0]+(ri'*z(1:ii))*ri;
0122         
0123         <span class="comment">% Can we store inverse of Rc too? If yes, then we can update the</span>
0124         <span class="comment">% direction instead of solving the whole problem.</span>
0125         t1 = cputime-t;
0126         t1 = toc;
0127         t_qr = t_qr+t1;
0128     <span class="keyword">end</span>
0129     
0130     <span class="comment">%% matlab qr update</span>
0131     <span class="keyword">if</span> qrM
0132         tic; t = cputime;
0133 <span class="comment">%         Q0t = [Q0 zeros(ii-1,1); zeros(1,ii-1) 1];</span>
0134 <span class="comment">%         R0t = [R0 zeros(ii-1,1); zeros(1,ii-1) 1];</span>
0135 <span class="comment">%         loc_vector = zeros(ii,1);</span>
0136 <span class="comment">%         loc_vector(end) = 1;</span>
0137 <span class="comment">%         ai = A(:,ii);</span>
0138 <span class="comment">%         Ata = A(:,1:ii-1)'*ai;</span>
0139 <span class="comment">%         rep_row = [Ata; ai'*ai]; % adds the new row to A'A</span>
0140 <span class="comment">%         [Q2t R2t] = qrupdate(Q0t, R0t, loc_vector, rep_row);</span>
0141 <span class="comment">%         rep_vec = [Ata; -1]; % adds remaining part of the column in A'A and removes the 1 introduced in the beginning.</span>
0142 <span class="comment">%         [Q0 R0] = qrupdate(Q2t, R2t, rep_vec, loc_vector);</span>
0143 <span class="comment">%         delx_qrM = R0\(Q0'*z(1:ii));</span>
0144         
0145         <span class="comment">% [Qt, Rt] = qrinsert(Q0, R0, ii, Ata,'col');</span>
0146         [Q0, R0] = qrinsert(Q0,R0, ii, A(:,ii),<span class="string">'col'</span>);
0147         delx_qrM = (R0\(R0'\z(1:ii)));
0148         t1 = cputime-t;
0149         t1 = toc;
0150         t_qrM = t_qrM+t1;
0151     <span class="keyword">end</span>
0152     
0153 <span class="keyword">end</span>
0154 <span class="keyword">if</span> error
0155     fprintf(<span class="string">'iter=%d, t_cgs=%3.4g, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g, errors: cgs=%3.4g, mil=%3.4g, qr=%3.4g, qrM=%3.4g.\n'</span>,ii, t_cgs, t_mil, t_qr, t_qrM, norm(delx-delx_cgs), norm(delx-delx_mil),norm(delx-delx_qr), norm(delx-delx_qrM));
0156 <span class="keyword">else</span>
0157     fprintf(<span class="string">'iter=%d, t_cgs=%3.4g, t_mil=%3.4g, t_qr=%3.4g, t_qrM=%3.4g.\n'</span>,ii, t_cgs, t_mil, t_qr, t_qrM);
0158 <span class="keyword">end</span>
0159</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>