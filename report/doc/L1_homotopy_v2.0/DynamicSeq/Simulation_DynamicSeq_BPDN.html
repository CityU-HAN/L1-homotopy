<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of Simulation_DynamicSeq_BPDN</title>
  <meta name="keywords" content="Simulation_DynamicSeq_BPDN">
  <meta name="description" content="Simulation for dynamic update with sequential measurements.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- ../menu.html L1_homotopy_v2.0 --><!-- menu.html DynamicSeq -->
<h1>Simulation_DynamicSeq_BPDN
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>Simulation for dynamic update with sequential measurements.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Simulation for dynamic update with sequential measurements.
 Compare warm start of GPSR and FPC with the homotopy update of BPDN.
 Need GPSR and FPC packages in your matlab path to run this simulation.</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="DynamicSeq_BPDN_function.html" class="code" title="function [xp_h, gamma_xh, iter, th] = DynamicSeq_BPDN_function(A, b, AtAgx, iAtAgx, y, w, xp, gamma_x, pk, tau, chk_e0, maxiter)">DynamicSeq_BPDN_function</a>	DynamicLasso_update_function.m</li><li><a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>	BPDN_homotopy_function.m</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% Simulation for dynamic update with sequential measurements.</span>
0002 <span class="comment">% Compare warm start of GPSR and FPC with the homotopy update of BPDN.</span>
0003 <span class="comment">% Need GPSR and FPC packages in your matlab path to run this simulation.</span>
0004 
0005 clear
0006 close all
0007 clear classes;
0008 
0009 sim_runs = 20; <span class="comment">% Use a large number of simulation run to compare the performance</span>
0010 tau_table = [.5 .1 .05 .01];
0011 outer_iterations = length(tau_table);
0012 stack_time_solve = zeros(sim_runs*outer_iterations,4);
0013 stack_time_update = zeros(sim_runs*outer_iterations,3);
0014 stack_iter = zeros(sim_runs*outer_iterations,7);
0015 
0016 <span class="keyword">for</span> out_iter = 1:outer_iterations
0017     <span class="keyword">for</span> sim_iter = 1:sim_runs
0018         <span class="comment">% n is the original signal length</span>
0019         n = 1024;
0020         <span class="comment">% m is number of observations to make</span>
0021         m = 512;
0022 
0023         <span class="comment">% number of spikes to put down</span>
0024         <span class="comment">% n_spikes = floor(.01*n);</span>
0025         ratio_sp = 5;
0026         n_spikes = round(m/ratio_sp);
0027         T = n_spikes;
0028 
0029         <span class="comment">% random +/- 1 signal</span>
0030         x = zeros(n,1);
0031         q = randperm(n);
0032         x(q(1:n_spikes)) = sign(randn(n_spikes,1));
0033         <span class="comment">% x(q(1:n_spikes)) = randn(n_spikes,1);</span>
0034 
0035         <span class="comment">% measurement matrix</span>
0036         G = randn(m,n)/sqrt(m);
0037         <span class="comment">% orthonormalize rows</span>
0038         <span class="comment">% G = orth(G')';</span>
0039         m_u =1;
0040         A = G(1:end-m_u,:);
0041         b = G(end-m_u+1:<span class="keyword">end</span>,:);
0042 
0043         hR = @(x) A*x;
0044         hRt = @(x) A'*x;
0045 
0046         <span class="comment">% noisy observations</span>
0047         sigma = 0.01; <span class="comment">% Add noise depending on the amplitude of y</span>
0048         e = sigma*randn(m-m_u,1);
0049         y = A*x + e;
0050 
0051         <span class="comment">% regularization parameter</span>
0052         tau = tau_table(out_iter)*max(abs(A'*y));
0053 
0054         <span class="comment">% Homotopy method</span>
0055         tic
0056         [xp, gamma_x, iter_xp, t_homotopy1] = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(A, y, tau,4*n); <span class="comment">%Lasso</span>
0057         t_homotopy1 = toc;
0058         tolA_h = tau*sum(abs(xp))+1/2*(norm(A*xp-y))^2;
0059 
0060         <span class="comment">% GPSR</span>
0061         pdg_scale = 1e-12;
0062         tolA = tolA_h*(1+pdg_scale);
0063         stopCri=4;
0064         debias = 0;
0065 
0066         first_tau_factor = 0.8*(max(abs(A'*y))/tau);
0067         steps = 5;
0068         tic;
0069         x_BB_mono = xp;
0070         [x_BB_mono,x_debias_BB_mono,obj_BB_mono,<span class="keyword">...</span>
0071             times_BB_mono,debias_start_BB_mono,mse]= <span class="keyword">...</span>
0072             GPSR_BB(y,hR,tau,<span class="keyword">...</span>
0073             <span class="string">'Debias'</span>,debias,<span class="keyword">...</span>
0074             <span class="string">'Monotone'</span>,1,<span class="keyword">...</span>
0075             <span class="string">'AT'</span>,hRt,<span class="keyword">...</span>
0076             <span class="string">'Initialization'</span>,0,<span class="keyword">...</span>
0077             <span class="string">'Continuation'</span>,1,<span class="keyword">...</span>
0078             <span class="string">'ContinuationSteps'</span>,steps,<span class="keyword">...</span>
0079             <span class="string">'FirstTauFactor'</span>,first_tau_factor,<span class="keyword">...</span>
0080             <span class="string">'StopCriterion'</span>,stopCri,<span class="keyword">...</span>
0081             <span class="string">'ToleranceA'</span>,tolA,<span class="keyword">...</span>
0082             <span class="string">'Verbose'</span>, 0, <span class="keyword">...</span>
0083             <span class="string">'ToleranceD'</span>,0.001);
0084         t_BB_mono = toc;
0085         
0086         <span class="comment">% FPC</span>
0087         opts.gtol = 1e-6;
0088         <span class="comment">%opts.f_value_tol = tolA;</span>
0089         opts.PrintOptions = 0;
0090         M = [];
0091         tic;
0092         [x_FPC, Out_FPC] = FPC_AS(n,A,y,tau,M,opts); <span class="comment">% call FPC_AS</span>
0093         t_FPC = toc;
0094         
0095         <span class="comment">% New measurement</span>
0096         chk_e0 = 1;  <span class="comment">% 0 or 1: This selects if we want to take U = (A'A+b'b) (1) or (A'A+e0*b'b) (0)...!</span>
0097         <span class="comment">% In simulation U = (A'A+b'b) works better</span>
0098 
0099         <span class="comment">% Gram matrix update</span>
0100         AtAgx = A(:,gamma_x)'*A(:,gamma_x)+chk_e0*b(:,gamma_x)'*b(:,gamma_x);
0101         iAtAgx = inv(AtAgx);
0102         pk_old = A'*(A*xp-y);
0103         w = b*x+randn(m_u,1)*sigma;
0104 
0105         <span class="comment">% Update using homotopy</span>
0106         tic
0107         [xp_h, gamma_xh, iter_xp_update, t_homotopy_update] =  <a href="DynamicSeq_BPDN_function.html" class="code" title="function [xp_h, gamma_xh, iter, th] = DynamicSeq_BPDN_function(A, b, AtAgx, iAtAgx, y, w, xp, gamma_x, pk, tau, chk_e0, maxiter)">DynamicSeq_BPDN_function</a>(A, b, AtAgx, iAtAgx, y, w, xp, gamma_x, pk_old, tau, chk_e0, 4*n);
0108         t_homotopy_update = toc;
0109         
0110         
0111         
0112         <span class="comment">% Compute using homotopy from scratch</span>
0113         y2 = [y; w];
0114         G = [A; b];
0115         tic
0116         [xp2, gamma_x2, iter_xp2, t_homotopy2] = <a href="../../L1_homotopy_v2.0/Pursuits_Homotopy/BPDN_homotopy_function.html" class="code" title="function out = BPDN_homotopy_function(A, y, in)">BPDN_homotopy_function</a>(G, y2, tau,4*n); <span class="comment">%Lasso</span>
0117         t_homotopy2 = toc;
0118         
0119         tolA_h = tau*sum(abs(xp2))+1/2*(norm(G*xp2-y2))^2;
0120 
0121         <span class="comment">% GPSR</span>
0122         tolA = tolA_h*(1+pdg_scale);
0123         stopCri=4;
0124         debias = 0;
0125 
0126         <span class="comment">% PUTTIN CONTINUATION IN HERE MAKES THINGS WORSE</span>
0127         tic;
0128         [x_BB_mono_update,x_debias_BB_mono,obj_BB_mono,<span class="keyword">...</span>
0129             times_BB_mono,debias_start_BB_mono,mse]= <span class="keyword">...</span>
0130             GPSR_BB(y2,G,tau,<span class="keyword">...</span>
0131             <span class="string">'Debias'</span>,debias,<span class="keyword">...</span>
0132             <span class="string">'Monotone'</span>,1,<span class="keyword">...</span>
0133             <span class="string">'Initialization'</span>,x_BB_mono,<span class="keyword">...</span>
0134             <span class="string">'StopCriterion'</span>,stopCri,<span class="keyword">...</span>
0135             <span class="string">'Verbose'</span>, 0, <span class="keyword">...</span>
0136             <span class="string">'ToleranceA'</span>,tolA,<span class="keyword">...</span>
0137             <span class="string">'ToleranceD'</span>,0.001);
0138         t_BB_mono_update = toc;
0139 
0140         <span class="comment">% FPC</span>
0141         opts.x0 = x_FPC;
0142 <span class="comment">%       opts.f_value_tol = tolA;</span>
0143         M = [];
0144         tic
0145         [x_FPC_update, Out_FPC_update] = FPC_AS(n,G,y2,tau,M,opts); <span class="comment">% call FPC_AS</span>
0146         t_FPC_update = toc;
0147 <span class="comment">%         stack_time_solve((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy1 t_BB_mono];</span>
0148 <span class="comment">%         stack_time_update((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy_update t_BB_mono_update];</span>
0149 <span class="comment">%         stack_iter((out_iter-1)*sim_runs+sim_iter,:) = [iter_xp iter_xp_update norm(x-xp) norm(x-xp_h) norm(x-x_BB_mono_update) length(times_BB_mono)];</span>
0150 
0151         stack_time_solve((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy2 t_homotopy1 t_BB_mono t_FPC];
0152         stack_time_update((out_iter-1)*sim_runs+sim_iter,:) = [t_homotopy_update t_BB_mono_update t_FPC_update];
0153         stack_iter((out_iter-1)*sim_runs+sim_iter,:) = [iter_xp2 iter_xp_update , length(times_BB_mono), (Out_FPC_update.nProdA+Out_FPC_update.nProdAt)/2 norm(x-xp_h)/norm(x) norm(xp_h-x_BB_mono_update)/norm(xp_h) norm(xp_h-x_FPC_update)/norm(xp_h)];
0154         [out_iter sim_iter]
0155     <span class="keyword">end</span>
0156 <span class="keyword">end</span>
0157 
0158 <span class="comment">% Generate table for performance</span>
0159 disp([<span class="string">'      DynamicSeq         BPDN homotopy           GPSR            FPC_AS'</span>]);
0160 
0161 table_stats = zeros(4,8);
0162 table_stats(:,3) = mean(reshape(stack_iter(:,1),sim_runs,outer_iterations));
0163 table_stats(:,1) = mean(reshape(stack_iter(:,2),sim_runs,outer_iterations));
0164 table_stats(:,5) = mean(reshape(stack_iter(:,3),sim_runs,outer_iterations));
0165 table_stats(:,7) = mean(reshape(stack_iter(:,4),sim_runs,outer_iterations));
0166 table_stats(:,4) = mean(reshape(stack_time_solve(:,1),sim_runs,outer_iterations));
0167 table_stats(:,2) = mean(reshape(stack_time_update(:,1),sim_runs,outer_iterations));
0168 table_stats(:,6) = mean(reshape(stack_time_update(:,2),sim_runs,outer_iterations));
0169 table_stats(:,8) = mean(reshape(stack_time_update(:,3),sim_runs,outer_iterations));
0170 table_stats</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>