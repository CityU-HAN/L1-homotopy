<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of demo_replaceDict</title>
  <meta name="keywords" content="demo_replaceDict">
  <meta name="description" content="demo_replaceDict">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
  <script type="text/javascript">
    if (top.frames.length == 0) { top.location = "../index.html"; };
  </script>
</head>
<body>
<a name="_top"></a>
<!-- menu.html L1_homotopy_v2.0 -->
<h1>demo_replaceDict
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>demo_replaceDict</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> demo_replaceDict

 Solves the following BPDN problem
 min_x  tau\|x\|_1 + 1/2*||y-Ax||_2^2
 
 and updates the solution as the A matrix is updated... 
 Infact, we can modify all the terms: y, A, and x simultaneously

 Applications:
       in dictionary learning where A is iteratively updated
       in tracking where y, A, and x, are updated..
 
 Written by: Salman Asif, Georgia Tech
 Email: sasif@gatech.edu
 Created: August 2012</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>	l1homotopy.m</li><li><a href="../L1_homotopy_v2.0/utils/genAmat.html" class="code" title="function A = genAmat(M,N,in);">genAmat</a>	</li><li><a href="../L1_homotopy_v2.0/utils/genSignal.html" class="code" title="function [x varargout] = genSignal(N,in)">genSignal</a>	Inputs</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">% demo_replaceDict</span>
0002 <span class="comment">%</span>
0003 <span class="comment">% Solves the following BPDN problem</span>
0004 <span class="comment">% min_x  tau\|x\|_1 + 1/2*||y-Ax||_2^2</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% and updates the solution as the A matrix is updated...</span>
0007 <span class="comment">% Infact, we can modify all the terms: y, A, and x simultaneously</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% Applications:</span>
0010 <span class="comment">%       in dictionary learning where A is iteratively updated</span>
0011 <span class="comment">%       in tracking where y, A, and x, are updated..</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Written by: Salman Asif, Georgia Tech</span>
0014 <span class="comment">% Email: sasif@gatech.edu</span>
0015 <span class="comment">% Created: August 2012</span>
0016 
0017 clear
0018 close all force
0019  
0020 <span class="comment">% Limit the number of computational threads (for profiling)</span>
0021 <span class="comment">% maxNumCompThreads(1);</span>
0022 
0023 <span class="comment">%% Setup path</span>
0024 mname = mfilename;
0025 mpath = mfilename(<span class="string">'fullpath'</span>);
0026 mdir = mpath(1:end-length(mname));
0027 cd(mdir);
0028 
0029 addpath utils/
0030 addpath utils/qr/
0031 
0032 disp([<span class="string">'--------------------'</span>,datestr(now),<span class="string">'-------------------------'</span>])
0033 
0034 <span class="comment">% load RandomStates</span>
0035 <span class="comment">%</span>
0036 rseed = 2012;
0037 rand(<span class="string">'state'</span>,rseed);
0038 randn(<span class="string">'state'</span>,rseed);
0039 
0040 <span class="comment">% simulation parameters</span>
0041 mType = <span class="string">'randn'</span>; <span class="comment">% {'randn','orth','rdct'};</span>
0042 sType = <span class="string">'randn'</span>; <span class="comment">% {'randn','sign','highD', 'blocks','pcwPoly'}</span>
0043 SNR = inf;       <span class="comment">% additive Gaussian noise</span>
0044 
0045 <span class="comment">% reweighted setup</span>
0046 rwt = 5;        <span class="comment">% number of reweighting iterations</span>
0047 
0048 N = 512;   <span class="comment">% signal length</span>
0049 M = round(N/2);    <span class="comment">% no. of measurements</span>
0050 T = round(M/4);    <span class="comment">% sparsity level</span>
0051 Tn = 0; <span class="comment">% round(T/10);  % update in the signal...</span>
0052 
0053 <span class="comment">% rank-1 update mode</span>
0054 delx_mode = <span class="string">'mil'</span>; <span class="comment">% mil or qr</span>
0055 fprintf(<span class="string">'Replace matrix A and/or signal x..\n'</span>);
0056 str0 = sprintf(<span class="string">'mType-%s, sType-%s, SNR = %d, (N,M,T) = %d, %d, %d.'</span>, mType, sType, SNR, N, M, T);
0057 disp(str0);
0058  
0059 maxsim = 10;
0060 SIM_stack = cell(maxsim,1);
0061 SIM_memory = cell(maxsim,1);
0062 
0063  
0064 <span class="keyword">for</span> sim = 1:maxsim
0065     
0066     <span class="comment">% Generate a random signal</span>
0067     in = []; in.type = sType; in.T = T; in.randgen = 1;
0068     x = <a href="../L1_homotopy_v2.0/utils/genSignal.html" class="code" title="function [x varargout] = genSignal(N,in)">genSignal</a>(N,in);
0069     [val ind] = sort(abs(x),<span class="string">'descend'</span>);
0070     ind_pos = ind(val&gt;1e-1);
0071     gamma_orig = ind_pos(1:min(length(ind_pos),M-1));
0072         
0073     <span class="comment">% measurement matrix</span>
0074     in = []; in.type = mType;
0075     A = <a href="../L1_homotopy_v2.0/utils/genAmat.html" class="code" title="function A = genAmat(M,N,in);">genAmat</a>(M,N,in);
0076     
0077     <span class="comment">% measurements</span>
0078     sigma = sqrt(norm(A*x)^2/10^(SNR/10)/M);    
0079     e = randn(M,1)*sigma;
0080     y = A*x+e;
0081     
0082     <span class="comment">%     % orthogonalize rows of A</span>
0083     <span class="comment">%     [Q, R] = qr(A',0);</span>
0084     <span class="comment">%     A = Q'; y = R' \ y;</span>
0085     
0086     <span class="comment">% parameter selection</span>
0087     <span class="comment">% tau = sigma*sqrt(log(N));</span>
0088     tau = max(1e-4*max(abs(A'*y)),sigma*sqrt(log(N)));
0089     
0090     maxiter = 4*N;
0091     err_fun = @(z) (norm(x-z)/norm(x))^2;
0092     
0093     <span class="comment">%% BPDN using l1homotopy</span>
0094     in = [];
0095     in.tau = tau;
0096     in.delx_mode = delx_mode;
0097     in.debias = 0;
0098     in.verbose = 0;
0099     in.plots = 0;
0100     in.record = 1;
0101     in.err_fun = err_fun;
0102     tic
0103     out = <a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>(A,y,in);
0104     xh = out.x_out;
0105     iter_bpdn = out.iter;
0106     time_bpdn = toc;
0107     gamma_bpdn = out.gamma;
0108     err_bpdn = out.error_table;
0109     
0110     <span class="comment">%% Update the solution after updating the measurement matrix and/or the</span>
0111     <span class="comment">% sparse signal</span>
0112     
0113     xh_old = xh; tau_old = tau;
0114     x_old = x; y_old = y; A_old = A;
0115     
0116     <span class="comment">% Update the measurement matrix</span>
0117     in = []; in.type = mType;
0118     B = <a href="../L1_homotopy_v2.0/utils/genAmat.html" class="code" title="function A = genAmat(M,N,in);">genAmat</a>(M,N,in);
0119     
0120     A = A_old+1/5*B;
0121     
0122     <span class="comment">% Update the sparse signal.</span>
0123     in = []; in.type = sType; in.T = Tn; in.randgen = 1;
0124     dx = <a href="../L1_homotopy_v2.0/utils/genSignal.html" class="code" title="function [x varargout] = genSignal(N,in)">genSignal</a>(N,in);
0125     x = x_old + dx;
0126     <span class="comment">% e = randn(M,1)*sigma;</span>
0127     y = A*x+e;
0128            
0129     <span class="comment">% parameter selection</span>
0130     <span class="comment">% tau = sigma*sqrt(log(N));</span>
0131     tau = max(1e-4*max(abs(A'*y)),sigma*sqrt(log(N)));
0132     
0133     homotopy_mode = <span class="string">'dummy'</span>;
0134     <span class="keyword">switch</span> homotopy_mode
0135         <span class="keyword">case</span> <span class="string">'dummy'</span>
0136             <span class="comment">% create a dummy variable...</span>
0137             <span class="comment">% use homotopy on the measurements...</span>
0138             <span class="comment">% in principle, we can start with any xh_old with this formulation</span>
0139             <span class="comment">% and any starting value of tau or W...</span>
0140             W = tau; 
0141             W_old = tau_old;
0142             <span class="comment">% yh = A*xh_old;</span>
0143             <span class="comment">% u =  -sign(xh_old).*W_old;</span>
0144             <span class="comment">% Atdyu = A'*(yh-y)-u;</span>
0145             yh = A*xh_old;
0146             Atr = A'*(A*xh_old-y);
0147             u =  -W.*sign(xh_old)-Atr;
0148             pk_old = Atr+u;
0149         <span class="keyword">otherwise</span>            
0150             didp(<span class="string">'Go back ... no escape'</span>);
0151     <span class="keyword">end</span> 
0152     
0153     in = out;
0154     gamma_old = in.gamma;
0155     <span class="keyword">switch</span> delx_mode
0156         <span class="keyword">case</span> <span class="string">'mil'</span>;
0157             <span class="comment">% in.delx_mode = 'mil';</span>
0158             <span class="comment">% The following gram matrix and its inverse can be used from the</span>
0159             <span class="comment">% previous homotopy. Too lazy to include that right now...</span>
0160             <span class="comment">% wt BPDN homotopy update</span>
0161             AtAgx = A(:,gamma_old)'*A(:,gamma_old);
0162             iAtAgx = inv(AtAgx);
0163             in.iAtA = iAtAgx;
0164         <span class="keyword">case</span> {<span class="string">'qr'</span>,<span class="string">'chol'</span>};
0165             <span class="comment">% in.delx_mode = 'qr';</span>
0166             [Q R] = qr(A(:,gamma_old),0);
0167             in.Q = Q; in.R = R;
0168         <span class="keyword">case</span> <span class="string">'qrM'</span>
0169             <span class="comment">% in.delx_mode = 'qrM';</span>
0170             [Q0 R0] = qr(A(:,gamma_old));
0171             in.Q0 = Q0; in.R0 = R0;
0172     <span class="keyword">end</span>
0173 
0174     in.xh_old = xh_old;
0175     in.pk_old = pk_old;
0176     <span class="comment">% in.Atdyu = Atdyu;</span>
0177     in.u = u;
0178     in.W = W;
0179     in.W_old = W_old;
0180     in.delx_mode = delx_mode;
0181     in.debias = 0;
0182     in.verbose = 0;
0183     in.plots = 0;
0184     in.record = 1;
0185     in.err_fun = @(z) (norm(x-z)/norm(x))^2;
0186     tic
0187     out = <a href="l1homotopy.html" class="code" title="function out = l1homotopy(A, y, opts)">l1homotopy</a>(A,y,in);
0188     xh_dynDict = out.x_out;
0189     gamma_dynDict = out.gamma;
0190     iter_dynDict = out.iter;
0191     time_dynDict = toc; 
0192      
0193     SIM_stack{sim} = [sim, tau, <span class="keyword">...</span>
0194         norm(x_old-xh)^2/norm(x)^2, sum(iter_bpdn,2), sum(time_bpdn,2), <span class="keyword">...</span>
0195         norm(x-xh_dynDict)^2/norm(x)^2, sum(iter_dynDict,2), sum(time_dynDict,2)];  
0196     
0197     fprintf(<span class="string">'sim %d. tau = %3.4g, (err,iter,time): l1homotopy from scratch-%3.4g,%3.4g,%3.4g; dynDict l1homotopy-%3.4g,%3.4g,%3.4g. \n'</span>, <span class="keyword">...</span>
0198         SIM_stack{sim});
0199    
0200     <span class="comment">%% plot recovered signals</span>
0201     figure(1); plot([x xh xh_dynDict]);
0202     title(<span class="string">'Comparison betweeen the new and old homotopy code'</span>)
0203 <span class="keyword">end</span>
0204 mS =  mean(cell2mat(SIM_stack),1);
0205 fprintf(<span class="string">'Average results: maxsim %d. tau = %3.4g, (err,iter,time): l1homotopy from scratch-%3.4g,%3.4g,%3.4g; dynDict l1homotopy-%3.4g,%3.4g,%3.4g. \n'</span>, maxsim, mS(2:end));</pre></div>
<hr><address>Generated on Sun 09-Jun-2013 02:08:02 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" target="_parent">m2html</a></strong> &copy; 2005</address>
</body>
</html>